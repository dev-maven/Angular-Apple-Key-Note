{"version":3,"file":"pe-builder-core.js","sources":["ng://@pe/builder-core/models/action.ts","ng://@pe/builder-core/models/client.ts","ng://@pe/builder-core/models/element.ts","ng://@pe/builder-core/constants.ts","ng://@pe/builder-core/shared/abstract.component.ts","ng://@pe/builder-core/abstract-api.service.ts","ng://@pe/builder-core/utils/create-logger.ts","ng://@pe/builder-core/utils/element-utils.ts","ng://@pe/builder-core/utils/generate-id.ts","ng://@pe/builder-core/actions/effects/context-schema.effects.ts","ng://@pe/builder-core/actions/effects/page.effects.ts","ng://@pe/builder-core/actions/effects/shop.effects.ts","ng://@pe/builder-core/actions/effects/stylesheet.effects.ts","ng://@pe/builder-core/actions/effects/template.effects.ts","ng://@pe/builder-core/actions/compiler.ts","ng://@pe/builder-core/actions/create-shop-init-action.ts","ng://@pe/builder-core/fixtures/element.fixtures.ts","ng://@pe/builder-core/fixtures/empty-shop.ts","ng://@pe/builder-core/index.ts","ng://@pe/builder-core/pe-builder-core.ts"],"sourcesContent":["export type PebActionId = string;\n\nexport interface PebAction {\n  id: PebActionId;\n  // TODO: add name\n  effects: PebEffect[];\n  createdAt: Date;\n}\n\nexport interface PebEffect {\n  type: PebShopEffect\n    | PebPageEffect\n    | PebTemplateEffect\n    | PebStylesheetEffect\n    | PebContextSchemaEffect;\n  target: string; // format: entityType:entityId\n  payload: any;\n}\n\nexport enum PebEffectTarget {\n  Shop = 'shop',\n  Pages = 'pages',\n  Templates = 'templates',\n  Stylesheets = 'stylesheets',\n  ContextSchemas = 'contextSchemas',\n}\n\nexport enum PebShopEffect {\n  Init = 'shop:init',\n  UpdateData = 'shop:update-data',\n  UpdatePages = 'shop:update-pages',\n  AppendPage = 'shop:append-page',\n  DeletePage = 'shop:delete-page',\n}\n\nexport enum PebPageEffect {\n  Create = 'page:init',\n  UpdateData = 'page:update-data',\n  Delete = 'page:delete',\n}\n\nexport enum PebTemplateEffect {\n  Init              = 'template:init',\n  Destroy           = 'template:destroy',\n  AppendElement     = 'template:append-element',\n  UpdateElement     = 'template:update-element',\n  RelocateElement   = 'template:relocate-element',\n  DeleteElement     = 'template:delete-element',\n}\n\nexport enum PebStylesheetEffect {\n  Init = 'stylesheet:init',\n  Update = 'stylesheet:update',\n  Delete = 'stylesheet:delete',\n}\n\nexport enum PebContextSchemaEffect {\n  Init = 'context-schema:init',\n  Update = 'context-schema:update',\n  Delete = 'context-schema:delete',\n}\n","import { InjectionToken } from '@angular/core';\n\nimport { PebActionId } from './action';\nimport { PebElement, PebElementType } from './element';\n\nexport type PebTemplateId = string;\nexport interface PebTemplate extends PebElement {\n  type: PebElementType.Document;\n}\n\nexport type PebStylesheetId = string;\nexport interface PebStylesheet {\n  [selector: string]: PebElementStyles;\n}\nexport interface PebElementStyles {\n  [style: string]: string | number;\n}\n\nexport type PebContextSchemaId = string;\nexport interface ContextSchemaItem {\n  service: string;\n  method: string;\n  params: any[];\n}\nexport interface PebContextSchema {\n  [key: string]: ContextSchemaItem;\n}\n\nexport enum PebPageType {\n  Master = 'master',\n  Replica = 'replica',\n}\n\nexport enum PebPageVariant {\n  Front = 'front',\n  Default = 'default',\n  Category = 'category',\n  Product = 'product',\n}\n\nexport type PebPageId = string;\nexport interface PebPage {\n  id: PebPageId;\n  name: string;\n  variant: PebPageVariant;\n  type: PebPageType;\n  master: null | {\n    id: PebPageId,\n    lastActionId: PebActionId\n  };\n  data: {\n    url?: string;\n    mark?: string;\n    preview?: string;\n  };\n  template: PebTemplate;\n  stylesheets: {\n    [screen: string]: PebStylesheet;\n  };\n  context: PebContextSchema;\n}\n\nexport type PebShopId = string;\nexport interface PebShop {\n  id: PebShopId;\n  data: {\n    frontPageId: PebPageId;\n  };\n  routing: {\n    [url: string]: PebPageId;\n  };\n  context: PebContextSchema;\n  pages: PebPage[];\n}\n\n// TODO: move to a more suitable location\nexport enum ContextService {\n  Company = 'company',\n  Products = 'products',\n  Shipments = 'shipments',\n}\n\n// TODO: move to a more suitable location\nexport const CONTEXT_SERVICES = {\n  [ContextService.Company]: new InjectionToken<any>('ContextServices.Company'),\n  [ContextService.Products]: new InjectionToken<any>('ContextServices.Products'),\n  [ContextService.Shipments]: new InjectionToken<any>('ContextServices.Shipments'),\n};\n","export type PebElementId = string;\n\nexport enum PebElementType {\n  Document = 'document',\n  Section = 'section',\n  Block = 'block',\n  Text = 'text',\n  Image = 'image',\n  Product = 'product',\n  ProductPage = 'productPage',\n  Button = 'button',\n  Cart = 'cart',\n  Shape = 'shape',\n  Carousel = 'carousel',\n  Amount = 'amount',\n  Logo = 'logo',\n  Products = 'shop-products',\n  Line = 'line',\n}\n\nexport enum PebMakerType {\n  Text = 'text',\n}\n\nexport interface PebElement {\n  id: PebElementId;\n  type: PebElementType;\n  children?: PebElement[];\n  data?: {\n    text?: string;\n    routes?: any[];\n    [others: string]: any;\n  };\n  meta?: {\n    deletable: boolean;\n  };\n}\n\nexport enum PebElementContextState {\n  Loading = 'loading',\n  Error = 'error',\n  Ready = 'ready',\n  Empty = 'empty',\n}\n\nexport interface PebElementWithParent extends PebElement {\n  priority: number;\n  parentId: string | null;\n}\n\nexport type PebElementContext<T> = {\n  state: PebElementContextState.Loading;\n} | {\n  state: PebElementContextState.Error;\n} | {\n  state: PebElementContextState.Empty;\n} | {\n  state: PebElementContextState.Ready;\n  data: T;\n};\n","export enum PebScreen {\n  Desktop = 'desktop',\n  Tablet = 'tablet',\n  Mobile = 'mobile',\n}\n","import { OnDestroy } from '@angular/core';\nimport { ReplaySubject } from 'rxjs';\n\nexport abstract class AbstractComponent implements OnDestroy {\n\n  protected destroyed$ = new ReplaySubject<boolean>();\n\n  ngOnDestroy(): void {\n    this.destroyed$.next(true);\n    this.destroyed$.complete();\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { PebAction } from './models/action';\nimport { PebShop, PebShopId } from './models/client';\nimport { PebShopThemeVersionEntity } from './models/database';\nimport { PebShopThemeId, PebShopThemeVersionId } from './models/editor';\n\nexport interface CreateShopThemePayload {\n  name: string;\n  content: PebShop;\n}\n\nexport type CreateShopThemeDto = any;\n\nexport abstract class PebApiService {\n  abstract getShopThemesList(): Observable<any>;\n\n  abstract getShopThemeById(themeId: PebShopThemeId): Observable<any>;\n\n  abstract createShopTheme(input: CreateShopThemePayload): Observable<CreateShopThemeDto>;\n\n  abstract createShopThemeVersion(shopId: PebShopId, name: string): Observable<PebShopThemeVersionEntity>;\n\n  abstract deleteShopThemeVersion(shopId: PebShopId, versionId: PebShopThemeVersionId): Observable<any>;\n\n  abstract activateShopThemeVersion(shopId: PebShopId, versionId: PebShopThemeVersionId): Observable<CreateShopThemeDto>;\n\n  abstract publishShopThemeVersion(shopId: PebShopId, versionId: PebShopThemeVersionId): Observable<any>;\n\n  abstract addAction(shopId: PebShopId, action: PebAction): Observable<any>;\n\n  abstract getShopThemeVersions(shopId: PebShopId): Observable<PebShopThemeVersionEntity[]>;\n\n  abstract updateReplica(themeId: string, oldInitAction: PebAction, newInitAction: PebAction): Observable<any>;\n\n  abstract undoAction(themeId: string): Observable<any>;\n}\n","const root: any = (typeof self === 'object' && self.self === self && self) ||\n  (typeof global === 'object' && global.global === global && global) ||\n  this;\n\nexport function pebCreateLogger(namespace: string): (...a: unknown[]) => unknown[] {\n  const acceptableNss = [\n    ...namespace\n      .split(':')\n      .map((el, i, all) =>\n        [...all.slice(0, i), '*'].join(':'),\n      ),\n    namespace,\n  ];\n\n  if (root.PEB_DEBUG\n    && root.PEB_DEBUG.split(',').find(\n      eNs => acceptableNss.includes(eNs),\n    )\n  ) {\n    return (...input) => {\n      // tslint:disable-next-line:no-console\n      console.log(\n        `%c ${namespace} `, 'background: #3078a8; color: white',\n        ...input,\n      );\n\n      return [...input];\n    };\n  }\n\n  return (...input) => [...input];\n}\n","import { isArray, isFunction, merge } from 'lodash-es';\n\nimport { PebTemplate } from '../models/client';\nimport { PebElement, PebElementId, PebElementWithParent } from '../models/element';\n\nexport function pebMapElementDeep(\n  element: PebElement,\n  handler: (el: PebElement) => PebElement,\n): PebElement {\n  const { children: children = [], ...elementProps } = handler(element);\n\n  return {\n    ...merge({}, elementProps),\n    children: children.map(child => pebMapElementDeep(child, handler)),\n  };\n}\n\nexport function pebFilterElementDeep(\n  element: PebElement,\n  handler: (el: PebElement) => boolean,\n): PebTemplate | PebElement {\n  const nextChildren = element.children?.filter(handler);\n\n  return {\n    ...merge({}, element),\n    children: nextChildren?.map(child => pebFilterElementDeep(child, handler)),\n  };\n}\n\nexport function pebTraverseElementDeep(\n  element: PebElement,\n  handler: (el: PebElement) => any,\n): void {\n  handler(merge({}, element));\n\n  if (isArray(element.children)) {\n    element.children.forEach(el => pebTraverseElementDeep(el, handler));\n  }\n}\n\nexport function pebFindElementParents(document: PebElement, id: PebElementId): PebElement[] {\n  const stack = [{ node: document, i: 0 }];\n  while (stack.length) {\n    let current = stack[stack.length - 1];\n    while (current.i < current.node.children.length) {\n      const node = current.node.children[current.i];\n\n      if (node.id === id) {\n        return stack\n          .filter(el => el.node.id !== document.id)\n          .map(el => el.node);\n      }\n\n      stack.push({ node, i: 0 });\n      current.i++;\n      current = stack[stack.length - 1];\n    }\n\n    stack.pop();\n  }\n\n  return null;\n}\n\nexport function pebFindElementChildren(\n  element: PebElement,\n  predicate?: ((e: PebElement) => boolean),\n): PebElement[] {\n  if (predicate && !isFunction(predicate)) {\n    throw new Error('Unsupported selector');\n  }\n\n  predicate = predicate || (() => true); // tslint:disable-line\n\n  const result = [];\n\n  pebTraverseElementDeep(element, el => {\n    if (predicate(el)) {\n      result.push(el);\n    }\n  });\n\n  return result;\n}\n\nexport function pebTraverseElementDeepWithParent(\n  element: PebElement,\n  handler: (el: any) => any,\n  parentId: null | string = null,\n  priority: any = -1,\n): void {\n  const nextPriority = parseInt(priority, 10) + 1;\n  handler({ ...element, parentId, priority: nextPriority });\n\n  if (isArray(element.children)) {\n    element.children.forEach(el => pebTraverseElementDeepWithParent(el, handler, element.id, nextPriority));\n  }\n}\n\nexport function pebFindElementChildrenWithParent(\n  element: PebElement,\n  predicate: ((e: PebElement) => boolean) = (() => true),\n): PebElementWithParent[] {\n  if (predicate && !isFunction(predicate)) {\n    throw new Error('Unsupported selector');\n  }\n\n  const result = [];\n\n  pebTraverseElementDeepWithParent(element, el => {\n    if (predicate(el)) {\n      result.push(el);\n    }\n  });\n\n  return result;\n}\n","import { random } from 'lodash-es';\nimport { v4 as uuid } from 'uuid';\n\n// This will allow us to detect global object both in browser and in backend\n// so in sandbox we could generate more readable ids and at the same time use\n// normal ones in production\nconst root: any = (typeof self === 'object' && self.self === self && self) ||\n  (typeof global === 'object' && global.global === global && global) ||\n  this;\n\n// const initialNamespaces = localStorage.getItem('peb-ids');\n\n// const idsNamespaces: {\n//   [ns: string]: number,\n// } = initialNamespaces ? JSON.parse(initialNamespaces) : {};\n\nexport function pebGenerateId(ns?: string): string {\n  // if (root.PEB_CUSTOM_IDS && ns) {\n  //   if (!(ns in idsNamespaces)) {\n  //     idsNamespaces[ns] = 0;\n  //   }\n\n  //   idsNamespaces[ns]++;\n\n  //   localStorage.setItem('peb-ids', JSON.stringify(idsNamespaces));\n\n  //   return `${ns}-${idsNamespaces[ns]}`;\n  // }\n\n  if (root.PEB_CUSTOM_IDS) {\n    const base = 36;\n\n    return Number(random(0, base ** 5 - 1)).toString(base);\n  }\n\n  return uuid();\n}\n","import { merge, omit } from 'lodash-es';\n\nimport { PebContextSchemaEffect } from '../../models/action';\nimport { PebContextSchema } from '../../models/client';\n\nexport const pebContextSchemaEffectHandlers: {\n  [effectName in PebContextSchemaEffect]: (schema: null | PebContextSchema, payload: PebContextSchema | string) => PebContextSchema | null\n} = {\n  [PebContextSchemaEffect.Init]: pebContextSchemaEffectInitHandler,\n  [PebContextSchemaEffect.Update]: pebContextSchemaEffectUpdateHandler,\n  [PebContextSchemaEffect.Delete]: pebContextSchemaEffectDeleteHandler,\n};\n\nexport function pebContextSchemaEffectInitHandler(_: null, payload: PebContextSchema): PebContextSchema {\n  return payload;\n}\n\nexport function pebContextSchemaEffectUpdateHandler(prevSchema: PebContextSchema, payload: PebContextSchema): PebContextSchema {\n  return merge({}, prevSchema, payload);\n}\n\nexport function pebContextSchemaEffectDeleteHandler(prevSchema: PebContextSchema, payload: string): PebContextSchema {\n  return null;\n}\n","import { PebPageEffect } from '../../models/action';\nimport { PebPageShort } from '../../models/editor';\n\nexport const pebPageEffectHandler: {\n  [effectName in PebPageEffect]: (page: null | PebPageShort, payload: any) => PebPageShort | null\n} = {\n  [PebPageEffect.Create]: pebPageEffectCreateHandler,\n  [PebPageEffect.UpdateData]: pebPageEffectUpdateDataHandler,\n  [PebPageEffect.Delete]: pebPageEffectDeleteHandler,\n};\n\nexport function pebPageEffectCreateHandler(_: null, payload: PebPageShort): PebPageShort {\n  return payload;\n}\n\nexport function pebPageEffectUpdateDataHandler(prevPage: PebPageShort, payload: any): PebPageShort {\n  return {\n    ...prevPage,\n    data: { ...prevPage.data, ...payload },\n  };\n}\n\nexport function pebPageEffectDeleteHandler(prevPage: PebPageShort, payload: any): null {\n  return null;\n}\n","import { PebShopEffect } from '../../models/action';\nimport { PebPageId } from '../../models/client';\nimport { PebShopShort } from '../../models/editor';\n\nexport const pebShopEffectHandlers: {\n  [effectName in PebShopEffect]: (prevShop: null | PebShopShort, payload: any) => PebShopShort\n} = {\n  [PebShopEffect.Init]: pebShopEffectCreateHandler,\n  [PebShopEffect.UpdateData]: pebShopEffectUpdateDataHandler,\n  [PebShopEffect.UpdatePages]: pebShopEffectUpdatePagesHandler,\n  [PebShopEffect.AppendPage]: pebShopEffectAppendPagesHandler,\n  [PebShopEffect.DeletePage]: pebShopEffectAppendPagesHandler,\n};\n\nexport function pebShopEffectCreateHandler(prevShop: null, payload: PebShopShort): PebShopShort {\n  return payload;\n}\nexport function pebShopEffectUpdateDataHandler(prevShop: PebShopShort, payload: { [key: string]: any }): PebShopShort {\n  // debugger;\n  return {\n    ...prevShop,\n    data: {\n      ...prevShop.data,\n      ...payload,\n    },\n  };\n}\nexport function pebShopEffectUpdatePagesHandler(prevShop: PebShopShort, payload: PebPageId[]): PebShopShort {\n  return {\n    ...prevShop,\n    pageIds: payload,\n  };\n}\n\nexport function pebShopEffectAppendPagesHandler(prevShop: PebShopShort, payload: PebPageId): PebShopShort {\n  return {\n    ...prevShop,\n    pageIds: [...prevShop.pageIds, payload],\n  };\n}\n\nexport function pebShopEffectDeletePagesHandler(prevShop: PebShopShort, payload: PebPageId): PebShopShort {\n  return {\n    ...prevShop,\n    pageIds: prevShop.pageIds.filter(id => id !== payload),\n  };\n}\n","import { merge } from 'lodash-es';\n\nimport { PebStylesheetEffect } from '../../models/action';\nimport { PebStylesheet } from '../../models/client';\n\nexport const pebStylesheetEffectHandlers: {\n  [effectName in PebStylesheetEffect]: (\n    stylesheet: null | PebStylesheet,\n    payload: PebStylesheet | string,\n  ) => PebStylesheet | null\n} = {\n  [PebStylesheetEffect.Init]: pebStylesheetInitHandler,\n  [PebStylesheetEffect.Update]: pebStylesheetUpdateHandler,\n  [PebStylesheetEffect.Delete]: pebStylesheetDeleteHandler,\n};\n\nexport function pebStylesheetInitHandler(_: null, payload: PebStylesheet): PebStylesheet {\n  return payload;\n}\n\nexport function pebStylesheetUpdateHandler(prevState: PebStylesheet, payload: PebStylesheet): PebStylesheet {\n  return merge(\n    {},\n    prevState,\n    payload,\n  );\n}\n\nexport function pebStylesheetDeleteHandler(): PebStylesheet {\n  return null;\n}\n","import { PebTemplateEffect } from '../../models/action';\nimport { PebTemplate } from '../../models/client';\nimport { PebElement } from '../../models/element';\nimport { pebFilterElementDeep, pebMapElementDeep } from '../../utils/element-utils';\n\nexport const layoutsScopeName = 'layouts';\n\nexport interface PebAppendElementPayload {\n  to: string;\n  after?: string;\n  element: PebElement;\n}\n\nexport const pebLayoutEffectHandlers: {\n  [effectName in PebTemplateEffect]: (prevLayout: null| PebTemplate, payload: any) => PebTemplate | null\n} = {\n  [PebTemplateEffect.Init]: pebLayoutInitHandler,\n  [PebTemplateEffect.Destroy]: pebLayoutDestroyHandler,\n  [PebTemplateEffect.AppendElement]: pebLayoutAppendElementHandler,\n  [PebTemplateEffect.UpdateElement]: pebLayoutUpdateElementHandler,\n  [PebTemplateEffect.RelocateElement]: pebLayoutRelocateElementHandler,\n  [PebTemplateEffect.DeleteElement]: pebLayoutDeleteElementHandler,\n};\n\nexport function pebLayoutInitHandler(prevLayout: null, payload: PebTemplate) {\n  return payload;\n}\n\nexport function pebLayoutDestroyHandler(prevLayout: null | PebTemplate) {\n  return null;\n}\n\nexport function pebLayoutAppendElementHandler(prevLayout: PebTemplate, payload: PebAppendElementPayload): PebTemplate {\n  return pebMapElementDeep(\n    prevLayout,\n    el => (el.id === payload.to ? { ...el, children: [...el.children, payload.element] } : el),\n  ) as PebTemplate;\n}\n\nexport function pebLayoutUpdateElementHandler(prevLayout: PebTemplate, payload: any) {\n  throw new Error('To implement');\n  return prevLayout;\n}\n\nexport function pebLayoutRelocateElementHandler(prevLayout: PebTemplate, payload: any) {\n  throw new Error('To implement');\n  return prevLayout;\n}\n\nexport function pebLayoutDeleteElementHandler(prevLayout: PebTemplate, payload: string): PebTemplate {\n  return pebFilterElementDeep(prevLayout, c => c.id !== payload) as PebTemplate;\n}\n","import { omit } from 'lodash-es';\n\nimport { PebAction, PebEffectTarget } from '../models/action';\nimport { PebShopThemeSnapshotEntity } from '../models/database';\nimport { pebContextSchemaEffectHandlers } from './effects/context-schema.effects';\nimport { pebPageEffectHandler } from './effects/page.effects';\nimport { pebShopEffectHandlers } from './effects/shop.effects';\nimport { pebStylesheetEffectHandlers } from './effects/stylesheet.effects';\nimport { pebLayoutEffectHandlers } from './effects/template.effects';\n\nconst createInitialShopSnapshot = (): PebShopThemeSnapshotEntity => ({\n  // TODO: is hash needed???\n  id: null,\n  shop: null,\n  pages: {},\n  templates: {},\n  stylesheets: {},\n  contextSchemas: {},\n});\n\nconst effectHandlers = {\n  ...pebShopEffectHandlers,\n  ...pebPageEffectHandler,\n  ...pebLayoutEffectHandlers,\n  ...pebStylesheetEffectHandlers,\n  ...pebContextSchemaEffectHandlers,\n};\n\nexport function pebActionHandler(input: PebShopThemeSnapshotEntity, action: PebAction): PebShopThemeSnapshotEntity {\n  return action.effects.reduce((prevState, effect) => {\n    const [areaName, areaId] = effect.target.split(':') as [ string, string ];\n    const handler = effectHandlers[effect.type];\n\n    if (!handler) {\n      throw new Error('Invalid effect type');\n    }\n\n    const collectionNames = Object.values(PebEffectTarget) as string[];\n\n    // TODO: Check if Maps are deeply copied\n    if (areaName === PebEffectTarget.Shop) {\n      // debugger;\n      return {\n        ...prevState,\n        shop: handler(prevState.shop as any, effect.payload),\n      } as any; // FIXME: Type??\n    } else if (collectionNames.includes(areaName)) {\n      const prevUnit = prevState[areaName][areaId] || null;\n      const nextUnit = handler(prevUnit, effect.payload);\n\n      const nextArea = Boolean(nextUnit)\n        ? { ...prevState[areaName], [areaId]: nextUnit }\n        : omit(prevState[areaName], areaId) as any;\n\n      return {\n        ...prevState,\n        [areaName]: nextArea,\n      };\n    }\n\n    throw new Error('Invalid effect target');\n  }, input);\n}\n\nexport const pebCompileActions = (actions: PebAction[]): PebShopThemeSnapshotEntity =>\n  actions.reduce(pebActionHandler, createInitialShopSnapshot());\n","import { PebScreen } from '../constants';\nimport {\n  PebAction,\n  PebContextSchemaEffect,\n  PebEffectTarget,\n  PebPageEffect,\n  PebShopEffect,\n  PebStylesheetEffect,\n  PebTemplateEffect,\n} from '../models/action';\nimport { PebShop } from '../models/client';\nimport { pebGenerateId } from '../utils/generate-id';\n\n// TODO: Properly handle shop with multiple pages\nexport const pebCreateShopInitAction = (shop: PebShop): PebAction => {\n  const page = shop.pages[0];\n\n  const shopContextId = pebGenerateId('context');\n\n  const pageTemplateId = pebGenerateId('template');\n  const stylesIds = {\n    [PebScreen.Desktop]: pebGenerateId('stylesheet'),\n    [PebScreen.Tablet]: pebGenerateId('stylesheet'),\n    [PebScreen.Mobile]: pebGenerateId('stylesheet'),\n  };\n  const pageContextId = pebGenerateId('context');\n\n  return {\n    id: pebGenerateId('action'),\n    createdAt: new Date(),\n    effects: [\n      {\n        type: PebTemplateEffect.Init,\n        target: `${PebEffectTarget.Templates}:${pageTemplateId}`,\n        payload: page.template,\n      },\n      ...Object.values(PebScreen).map(screen => ({\n        type: PebStylesheetEffect.Init,\n        target: `${PebEffectTarget.Stylesheets}:${stylesIds[screen]}`,\n        payload: page.stylesheets[screen],\n      })),\n      {\n        type: PebContextSchemaEffect.Init,\n        target: `${PebEffectTarget.ContextSchemas}:${pageContextId}`,\n        payload: page.context,\n      },\n      {\n        type: PebPageEffect.Create,\n        target: `${PebEffectTarget.Pages}:${page.id}`,\n        payload: {\n          id: page.id,\n          type: page.type,\n          variant: page.variant,\n          master: page.master,\n          name: page.name,\n          data: page.data,\n          templateId: pageTemplateId,\n          stylesheetIds: {\n            [PebScreen.Desktop]: `${stylesIds[PebScreen.Desktop]}`,\n            [PebScreen.Tablet]: `${stylesIds[PebScreen.Tablet]}`,\n            [PebScreen.Mobile]: `${stylesIds[PebScreen.Mobile]}`,\n          },\n          contextId: `${pageContextId}`,\n        },\n      },\n      {\n        type: PebContextSchemaEffect.Init,\n        target: `${PebEffectTarget.ContextSchemas}:${shopContextId}`,\n        payload: {},\n      },\n      {\n        type: PebShopEffect.Init,\n        target: PebEffectTarget.Shop,\n        payload: {\n          data: {\n            frontPageId: page.id,\n          },\n          contextId: shopContextId,\n          pageIds: [page.id],\n        },\n      },\n    ],\n  };\n};\n","import { ContextSchemaItem, PebContextSchema, PebElementStyles } from '../models/client';\nimport { PebElement, PebElementType } from '../models/element';\nimport { pebGenerateId } from '../utils/generate-id';\n\ntype ElementPayload = Partial<PebElement> & ({ type: PebElementType });\n\nexport interface PebElementKit {\n  element: PebElement;\n  styles: { [screenId: string]: PebElementStyles };\n  contextSchema: PebContextSchema;\n}\n\n// TODO: Delete after 25.04 if not used\nexport const pebCreateElementKit = (\n  elementPayload: ElementPayload,\n  styles?: { [screen: string]: PebElementStyles },\n  contextItem?: ContextSchemaItem,\n): PebElementKit => {\n  const element = {\n    ...elementPayload,\n    id: pebGenerateId(),\n  };\n\n  return {\n    element,\n    styles,\n    contextSchema: {\n      [element.id]: contextItem,\n    },\n  };\n};\n","import { PebScreen } from '../constants';\nimport { PebPage, PebPageType, PebPageVariant, PebShop, PebTemplate } from '../models/client';\nimport { PebElementType } from '../models/element';\nimport { pebGenerateId } from '../utils/generate-id';\nimport { random } from 'lodash-es';\n\nexport const pebCreateEmptyPage = (name, type: PebPageType = PebPageType.Replica, variant = PebPageVariant.Default): PebPage => {\n\n  const line = {\n    id: pebGenerateId(),\n    type: PebElementType.Line,\n  };\n\n  const template: PebTemplate = {\n    id: pebGenerateId('element'),\n    type: PebElementType.Document,\n    children: ['header', 'body', 'footer'].map(sectionName => ({\n      id: pebGenerateId('element'),\n      type: PebElementType.Section,\n      data: { name: sectionName },\n      meta: { deletable: false },\n      children: [\n        ...(sectionName === 'header' ? [\n          {\n            id: pebGenerateId('element'),\n            type: PebElementType.Block,\n            children: [\n              {\n                id: pebGenerateId('element'),\n                type: PebElementType.Text,\n                data: {\n                  text: name,\n                },\n              },\n            ],\n          },\n        ] : []),\n      ],\n    })),\n  };\n\n  const [headerId, bodyId, footerId] = template.children.map(el => el.id);\n  const headerBlockId = template.children[0].children[0].id;\n  const blockColor = '#' + Number(random(0, 16 ** 6)).toString(16);\n\n  return  {\n    id: pebGenerateId('page'),\n    name,\n    type,\n    variant,\n    master: null,\n    data: {\n      url: '/',\n      mark: null,\n    },\n    template,\n    stylesheets: {\n      [PebScreen.Desktop]: {\n        [headerId]: { height: 200 },\n        [bodyId]: { height: 600 },\n        [footerId]: { height: 200 },\n        [headerBlockId]: {\n          height: 150,\n          width: 150,\n          backgroundColor: blockColor,\n        },\n        [line.id]: {height: 2},\n      },\n      [PebScreen.Tablet]: {\n        [headerId]: { height: 200 },\n        [bodyId]: { height: 600 },\n        [footerId]: { height: 200 },\n        [headerBlockId]: {\n          height: 150,\n          width: 150,\n          backgroundColor: blockColor,\n        },\n        [line.id]: {height: 2},\n      },\n      [PebScreen.Mobile]: {\n        [headerId]: { height: 200 },\n        [bodyId]: { height: 600 },\n        [footerId]: { height: 200 },\n        [headerBlockId]: {\n          height: 150,\n          width: 150,\n          backgroundColor: blockColor,\n        },\n        [line.id]: {height: 2},\n      },\n    },\n    context: {},\n  };\n};\n\nexport function pebCreateEmptyShop(): PebShop {\n  const frontPage = pebCreateEmptyPage('Front');\n\n  return {\n    id: pebGenerateId(),\n    data: {\n      frontPageId: frontPage.id,\n    },\n    routing: {\n      '/': frontPage.id,\n    },\n    context: {},\n    pages: [frontPage],\n  };\n}\n","/*\n * Public API Surface of core\n */\n\nexport * from './models/action';\n\nexport * from './models/client';\n\nexport * from './models/database';\n\nexport * from './models/editor';\n\nexport * from './models/element';\n\nexport * from './constants';\n\nexport * from './shared/abstract.component';\n\nexport * from './abstract-api.service';\n\nexport * from './utils/create-logger';\n\nexport * from './utils/element-utils';\n\nexport * from './utils/generate-id';\n\nexport * from './actions/compiler';\n\nexport * from './actions/create-shop-init-action';\n\nexport * from './fixtures/element.fixtures';\n\nexport * from './fixtures/empty-shop';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["this","root","uuid","_a"],"mappings":"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"}