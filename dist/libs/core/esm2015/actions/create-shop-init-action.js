import { PebScreen } from '../constants';
import { PebContextSchemaEffect, PebEffectTarget, PebPageEffect, PebShopEffect, PebStylesheetEffect, PebTemplateEffect, } from '../models/action';
import { pebGenerateId } from '../utils/generate-id';
// TODO: Properly handle shop with multiple pages
export const pebCreateShopInitAction = (shop) => {
    const page = shop.pages[0];
    const shopContextId = pebGenerateId('context');
    const pageTemplateId = pebGenerateId('template');
    const stylesIds = {
        [PebScreen.Desktop]: pebGenerateId('stylesheet'),
        [PebScreen.Tablet]: pebGenerateId('stylesheet'),
        [PebScreen.Mobile]: pebGenerateId('stylesheet'),
    };
    const pageContextId = pebGenerateId('context');
    return {
        id: pebGenerateId('action'),
        createdAt: new Date(),
        effects: [
            {
                type: PebTemplateEffect.Init,
                target: `${PebEffectTarget.Templates}:${pageTemplateId}`,
                payload: page.template,
            },
            ...Object.values(PebScreen).map(screen => ({
                type: PebStylesheetEffect.Init,
                target: `${PebEffectTarget.Stylesheets}:${stylesIds[screen]}`,
                payload: page.stylesheets[screen],
            })),
            {
                type: PebContextSchemaEffect.Init,
                target: `${PebEffectTarget.ContextSchemas}:${pageContextId}`,
                payload: page.context,
            },
            {
                type: PebPageEffect.Create,
                target: `${PebEffectTarget.Pages}:${page.id}`,
                payload: {
                    id: page.id,
                    type: page.type,
                    variant: page.variant,
                    master: page.master,
                    name: page.name,
                    data: page.data,
                    templateId: pageTemplateId,
                    stylesheetIds: {
                        [PebScreen.Desktop]: `${stylesIds[PebScreen.Desktop]}`,
                        [PebScreen.Tablet]: `${stylesIds[PebScreen.Tablet]}`,
                        [PebScreen.Mobile]: `${stylesIds[PebScreen.Mobile]}`,
                    },
                    contextId: `${pageContextId}`,
                },
            },
            {
                type: PebContextSchemaEffect.Init,
                target: `${PebEffectTarget.ContextSchemas}:${shopContextId}`,
                payload: {},
            },
            {
                type: PebShopEffect.Init,
                target: PebEffectTarget.Shop,
                payload: {
                    data: {
                        frontPageId: page.id,
                    },
                    contextId: shopContextId,
                    pageIds: [page.id],
                },
            },
        ],
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLXNob3AtaW5pdC1hY3Rpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcGUvYnVpbGRlci1jb3JlLyIsInNvdXJjZXMiOlsiYWN0aW9ucy9jcmVhdGUtc2hvcC1pbml0LWFjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDLE9BQU8sRUFFTCxzQkFBc0IsRUFDdEIsZUFBZSxFQUNmLGFBQWEsRUFDYixhQUFhLEVBQ2IsbUJBQW1CLEVBQ25CLGlCQUFpQixHQUNsQixNQUFNLGtCQUFrQixDQUFDO0FBRTFCLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUVyRCxpREFBaUQ7QUFDakQsTUFBTSxDQUFDLE1BQU0sdUJBQXVCLEdBQUcsQ0FBQyxJQUFhLEVBQWEsRUFBRTtJQUNsRSxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTNCLE1BQU0sYUFBYSxHQUFHLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUUvQyxNQUFNLGNBQWMsR0FBRyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDakQsTUFBTSxTQUFTLEdBQUc7UUFDaEIsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUUsYUFBYSxDQUFDLFlBQVksQ0FBQztRQUNoRCxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxhQUFhLENBQUMsWUFBWSxDQUFDO1FBQy9DLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLGFBQWEsQ0FBQyxZQUFZLENBQUM7S0FDaEQsQ0FBQztJQUNGLE1BQU0sYUFBYSxHQUFHLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUUvQyxPQUFPO1FBQ0wsRUFBRSxFQUFFLGFBQWEsQ0FBQyxRQUFRLENBQUM7UUFDM0IsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1FBQ3JCLE9BQU8sRUFBRTtZQUNQO2dCQUNFLElBQUksRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO2dCQUM1QixNQUFNLEVBQUUsR0FBRyxlQUFlLENBQUMsU0FBUyxJQUFJLGNBQWMsRUFBRTtnQkFDeEQsT0FBTyxFQUFFLElBQUksQ0FBQyxRQUFRO2FBQ3ZCO1lBQ0QsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ3pDLElBQUksRUFBRSxtQkFBbUIsQ0FBQyxJQUFJO2dCQUM5QixNQUFNLEVBQUUsR0FBRyxlQUFlLENBQUMsV0FBVyxJQUFJLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDN0QsT0FBTyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDO2FBQ2xDLENBQUMsQ0FBQztZQUNIO2dCQUNFLElBQUksRUFBRSxzQkFBc0IsQ0FBQyxJQUFJO2dCQUNqQyxNQUFNLEVBQUUsR0FBRyxlQUFlLENBQUMsY0FBYyxJQUFJLGFBQWEsRUFBRTtnQkFDNUQsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO2FBQ3RCO1lBQ0Q7Z0JBQ0UsSUFBSSxFQUFFLGFBQWEsQ0FBQyxNQUFNO2dCQUMxQixNQUFNLEVBQUUsR0FBRyxlQUFlLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQzdDLE9BQU8sRUFBRTtvQkFDUCxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUU7b0JBQ1gsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO29CQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztvQkFDckIsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO29CQUNuQixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7b0JBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO29CQUNmLFVBQVUsRUFBRSxjQUFjO29CQUMxQixhQUFhLEVBQUU7d0JBQ2IsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFO3dCQUN0RCxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQUU7d0JBQ3BELENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRTtxQkFDckQ7b0JBQ0QsU0FBUyxFQUFFLEdBQUcsYUFBYSxFQUFFO2lCQUM5QjthQUNGO1lBQ0Q7Z0JBQ0UsSUFBSSxFQUFFLHNCQUFzQixDQUFDLElBQUk7Z0JBQ2pDLE1BQU0sRUFBRSxHQUFHLGVBQWUsQ0FBQyxjQUFjLElBQUksYUFBYSxFQUFFO2dCQUM1RCxPQUFPLEVBQUUsRUFBRTthQUNaO1lBQ0Q7Z0JBQ0UsSUFBSSxFQUFFLGFBQWEsQ0FBQyxJQUFJO2dCQUN4QixNQUFNLEVBQUUsZUFBZSxDQUFDLElBQUk7Z0JBQzVCLE9BQU8sRUFBRTtvQkFDUCxJQUFJLEVBQUU7d0JBQ0osV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFO3FCQUNyQjtvQkFDRCxTQUFTLEVBQUUsYUFBYTtvQkFDeEIsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztpQkFDbkI7YUFDRjtTQUNGO0tBQ0YsQ0FBQztBQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBlYlNjcmVlbiB9IGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQge1xuICBQZWJBY3Rpb24sXG4gIFBlYkNvbnRleHRTY2hlbWFFZmZlY3QsXG4gIFBlYkVmZmVjdFRhcmdldCxcbiAgUGViUGFnZUVmZmVjdCxcbiAgUGViU2hvcEVmZmVjdCxcbiAgUGViU3R5bGVzaGVldEVmZmVjdCxcbiAgUGViVGVtcGxhdGVFZmZlY3QsXG59IGZyb20gJy4uL21vZGVscy9hY3Rpb24nO1xuaW1wb3J0IHsgUGViU2hvcCB9IGZyb20gJy4uL21vZGVscy9jbGllbnQnO1xuaW1wb3J0IHsgcGViR2VuZXJhdGVJZCB9IGZyb20gJy4uL3V0aWxzL2dlbmVyYXRlLWlkJztcblxuLy8gVE9ETzogUHJvcGVybHkgaGFuZGxlIHNob3Agd2l0aCBtdWx0aXBsZSBwYWdlc1xuZXhwb3J0IGNvbnN0IHBlYkNyZWF0ZVNob3BJbml0QWN0aW9uID0gKHNob3A6IFBlYlNob3ApOiBQZWJBY3Rpb24gPT4ge1xuICBjb25zdCBwYWdlID0gc2hvcC5wYWdlc1swXTtcblxuICBjb25zdCBzaG9wQ29udGV4dElkID0gcGViR2VuZXJhdGVJZCgnY29udGV4dCcpO1xuXG4gIGNvbnN0IHBhZ2VUZW1wbGF0ZUlkID0gcGViR2VuZXJhdGVJZCgndGVtcGxhdGUnKTtcbiAgY29uc3Qgc3R5bGVzSWRzID0ge1xuICAgIFtQZWJTY3JlZW4uRGVza3RvcF06IHBlYkdlbmVyYXRlSWQoJ3N0eWxlc2hlZXQnKSxcbiAgICBbUGViU2NyZWVuLlRhYmxldF06IHBlYkdlbmVyYXRlSWQoJ3N0eWxlc2hlZXQnKSxcbiAgICBbUGViU2NyZWVuLk1vYmlsZV06IHBlYkdlbmVyYXRlSWQoJ3N0eWxlc2hlZXQnKSxcbiAgfTtcbiAgY29uc3QgcGFnZUNvbnRleHRJZCA9IHBlYkdlbmVyYXRlSWQoJ2NvbnRleHQnKTtcblxuICByZXR1cm4ge1xuICAgIGlkOiBwZWJHZW5lcmF0ZUlkKCdhY3Rpb24nKSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgZWZmZWN0czogW1xuICAgICAge1xuICAgICAgICB0eXBlOiBQZWJUZW1wbGF0ZUVmZmVjdC5Jbml0LFxuICAgICAgICB0YXJnZXQ6IGAke1BlYkVmZmVjdFRhcmdldC5UZW1wbGF0ZXN9OiR7cGFnZVRlbXBsYXRlSWR9YCxcbiAgICAgICAgcGF5bG9hZDogcGFnZS50ZW1wbGF0ZSxcbiAgICAgIH0sXG4gICAgICAuLi5PYmplY3QudmFsdWVzKFBlYlNjcmVlbikubWFwKHNjcmVlbiA9PiAoe1xuICAgICAgICB0eXBlOiBQZWJTdHlsZXNoZWV0RWZmZWN0LkluaXQsXG4gICAgICAgIHRhcmdldDogYCR7UGViRWZmZWN0VGFyZ2V0LlN0eWxlc2hlZXRzfToke3N0eWxlc0lkc1tzY3JlZW5dfWAsXG4gICAgICAgIHBheWxvYWQ6IHBhZ2Uuc3R5bGVzaGVldHNbc2NyZWVuXSxcbiAgICAgIH0pKSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUGViQ29udGV4dFNjaGVtYUVmZmVjdC5Jbml0LFxuICAgICAgICB0YXJnZXQ6IGAke1BlYkVmZmVjdFRhcmdldC5Db250ZXh0U2NoZW1hc306JHtwYWdlQ29udGV4dElkfWAsXG4gICAgICAgIHBheWxvYWQ6IHBhZ2UuY29udGV4dCxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFBlYlBhZ2VFZmZlY3QuQ3JlYXRlLFxuICAgICAgICB0YXJnZXQ6IGAke1BlYkVmZmVjdFRhcmdldC5QYWdlc306JHtwYWdlLmlkfWAsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICBpZDogcGFnZS5pZCxcbiAgICAgICAgICB0eXBlOiBwYWdlLnR5cGUsXG4gICAgICAgICAgdmFyaWFudDogcGFnZS52YXJpYW50LFxuICAgICAgICAgIG1hc3RlcjogcGFnZS5tYXN0ZXIsXG4gICAgICAgICAgbmFtZTogcGFnZS5uYW1lLFxuICAgICAgICAgIGRhdGE6IHBhZ2UuZGF0YSxcbiAgICAgICAgICB0ZW1wbGF0ZUlkOiBwYWdlVGVtcGxhdGVJZCxcbiAgICAgICAgICBzdHlsZXNoZWV0SWRzOiB7XG4gICAgICAgICAgICBbUGViU2NyZWVuLkRlc2t0b3BdOiBgJHtzdHlsZXNJZHNbUGViU2NyZWVuLkRlc2t0b3BdfWAsXG4gICAgICAgICAgICBbUGViU2NyZWVuLlRhYmxldF06IGAke3N0eWxlc0lkc1tQZWJTY3JlZW4uVGFibGV0XX1gLFxuICAgICAgICAgICAgW1BlYlNjcmVlbi5Nb2JpbGVdOiBgJHtzdHlsZXNJZHNbUGViU2NyZWVuLk1vYmlsZV19YCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbnRleHRJZDogYCR7cGFnZUNvbnRleHRJZH1gLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUGViQ29udGV4dFNjaGVtYUVmZmVjdC5Jbml0LFxuICAgICAgICB0YXJnZXQ6IGAke1BlYkVmZmVjdFRhcmdldC5Db250ZXh0U2NoZW1hc306JHtzaG9wQ29udGV4dElkfWAsXG4gICAgICAgIHBheWxvYWQ6IHt9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUGViU2hvcEVmZmVjdC5Jbml0LFxuICAgICAgICB0YXJnZXQ6IFBlYkVmZmVjdFRhcmdldC5TaG9wLFxuICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgZnJvbnRQYWdlSWQ6IHBhZ2UuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb250ZXh0SWQ6IHNob3BDb250ZXh0SWQsXG4gICAgICAgICAgcGFnZUlkczogW3BhZ2UuaWRdLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICBdLFxuICB9O1xufTtcbiJdfQ==