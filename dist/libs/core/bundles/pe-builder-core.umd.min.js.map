{"version":3,"sources":["../../../../node_modules/tslib/tslib.es6.js","ng://@pe/builder-core/models/action.ts","ng://@pe/builder-core/models/client.ts","ng://@pe/builder-core/models/element.ts","ng://@pe/builder-core/constants.ts","ng://@pe/builder-core/shared/abstract.component.ts","ng://@pe/builder-core/abstract-api.service.ts","ng://@pe/builder-core/utils/create-logger.ts","ng://@pe/builder-core/utils/element-utils.ts","ng://@pe/builder-core/utils/generate-id.ts","ng://@pe/builder-core/actions/effects/context-schema.effects.ts","ng://@pe/builder-core/actions/effects/page.effects.ts","ng://@pe/builder-core/actions/effects/shop.effects.ts","ng://@pe/builder-core/actions/effects/stylesheet.effects.ts","ng://@pe/builder-core/actions/effects/template.effects.ts","ng://@pe/builder-core/actions/compiler.ts","ng://@pe/builder-core/fixtures/empty-shop.ts","ng://@pe/builder-core/fixtures/element.fixtures.ts","ng://@pe/builder-core/actions/create-shop-init-action.ts"],"names":["PebEffectTarget","PebShopEffect","PebPageEffect","PebTemplateEffect","PebStylesheetEffect","PebContextSchemaEffect","PebPageType","PebPageVariant","ContextService","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__read","o","m","Symbol","iterator","r","e","ar","next","done","push","value","error","__spread","concat","PebElementType","PebElementContextState","PebScreen","CONTEXT_SERVICES","_a","Company","InjectionToken","Products","Shipments","PebMakerType","AbstractComponent","destroyed$","ReplaySubject","ngOnDestroy","complete","root","self","global","pebMapElementDeep","element","handler","_b","children","elementProps","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__rest","merge","map","child","pebFilterElementDeep","nextChildren","filter","pebTraverseElementDeep","isArray","forEach","el","pebTraverseElementDeepWithParent","parentId","priority","nextPriority","parseInt","id","pebGenerateId","ns","PEB_CUSTOM_IDS","Number","random","Math","pow","toString","uuid","pebContextSchemaEffectHandlers","_a$1","Init","_","payload","Update","prevSchema","Delete","pebPageEffectHandler","_a$2","Create","UpdateData","prevPage","data","pebShopEffectHandlers","_a$3","prevShop","UpdatePages","pageIds","AppendPage","pebShopEffectAppendPagesHandler","DeletePage","pebStylesheetEffectHandlers","_a$4","prevState","pebLayoutEffectHandlers","_a$5","prevLayout","Destroy","AppendElement","to","UpdateElement","Error","RelocateElement","DeleteElement","c","effectHandlers","pebActionHandler","input","action","effects","reduce","effect","_c","target","split","areaName","areaId","type","collectionNames","values","Shop","shop","includes","nextUnit","nextArea","Boolean","omit","pebCreateEmptyPage","name","variant","Replica","Default","line","template","Line","Document","sectionName","Section","meta","deletable","Block","Text","text","_e","headerId","bodyId","footerId","headerBlockId","blockColor","master","url","mark","stylesheets","Desktop","height","width","backgroundColor","Tablet","Mobile","_d","context","actions","pages","templates","contextSchemas","elementPayload","styles","contextItem","contextSchema","frontPage","frontPageId","routing","/","namespace","acceptableNss","all","slice","join","PEB_DEBUG","find","eNs","_i","console","log","page","shopContextId","pageTemplateId","stylesIds","pageContextId","createdAt","Date","Templates","screen","Stylesheets","ContextSchemas","Pages","templateId","stylesheetIds","contextId","predicate","isFunction","result","document","stack","node","current","pop"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export type PebActionId = string;\n\nexport interface PebAction {\n  id: PebActionId;\n  // TODO: add name\n  effects: PebEffect[];\n  createdAt: Date;\n}\n\nexport interface PebEffect {\n  type: PebShopEffect\n    | PebPageEffect\n    | PebTemplateEffect\n    | PebStylesheetEffect\n    | PebContextSchemaEffect;\n  target: string; // format: entityType:entityId\n  payload: any;\n}\n\nexport enum PebEffectTarget {\n  Shop = 'shop',\n  Pages = 'pages',\n  Templates = 'templates',\n  Stylesheets = 'stylesheets',\n  ContextSchemas = 'contextSchemas',\n}\n\nexport enum PebShopEffect {\n  Init = 'shop:init',\n  UpdateData = 'shop:update-data',\n  UpdatePages = 'shop:update-pages',\n  AppendPage = 'shop:append-page',\n  DeletePage = 'shop:delete-page',\n}\n\nexport enum PebPageEffect {\n  Create = 'page:init',\n  UpdateData = 'page:update-data',\n  Delete = 'page:delete',\n}\n\nexport enum PebTemplateEffect {\n  Init              = 'template:init',\n  Destroy           = 'template:destroy',\n  AppendElement     = 'template:append-element',\n  UpdateElement     = 'template:update-element',\n  RelocateElement   = 'template:relocate-element',\n  DeleteElement     = 'template:delete-element',\n}\n\nexport enum PebStylesheetEffect {\n  Init = 'stylesheet:init',\n  Update = 'stylesheet:update',\n  Delete = 'stylesheet:delete',\n}\n\nexport enum PebContextSchemaEffect {\n  Init = 'context-schema:init',\n  Update = 'context-schema:update',\n  Delete = 'context-schema:delete',\n}\n","import { InjectionToken } from '@angular/core';\n\nimport { PebActionId } from './action';\nimport { PebElement, PebElementType } from './element';\n\nexport type PebTemplateId = string;\nexport interface PebTemplate extends PebElement {\n  type: PebElementType.Document;\n}\n\nexport type PebStylesheetId = string;\nexport interface PebStylesheet {\n  [selector: string]: PebElementStyles;\n}\nexport interface PebElementStyles {\n  [style: string]: string | number;\n}\n\nexport type PebContextSchemaId = string;\nexport interface ContextSchemaItem {\n  service: string;\n  method: string;\n  params: any[];\n}\nexport interface PebContextSchema {\n  [key: string]: ContextSchemaItem;\n}\n\nexport enum PebPageType {\n  Master = 'master',\n  Replica = 'replica',\n}\n\nexport enum PebPageVariant {\n  Front = 'front',\n  Default = 'default',\n  Category = 'category',\n  Product = 'product',\n}\n\nexport type PebPageId = string;\nexport interface PebPage {\n  id: PebPageId;\n  name: string;\n  variant: PebPageVariant;\n  type: PebPageType;\n  master: null | {\n    id: PebPageId,\n    lastActionId: PebActionId\n  };\n  data: {\n    url?: string;\n    mark?: string;\n    preview?: string;\n  };\n  template: PebTemplate;\n  stylesheets: {\n    [screen: string]: PebStylesheet;\n  };\n  context: PebContextSchema;\n}\n\nexport type PebShopId = string;\nexport interface PebShop {\n  id: PebShopId;\n  data: {\n    frontPageId: PebPageId;\n  };\n  routing: {\n    [url: string]: PebPageId;\n  };\n  context: PebContextSchema;\n  pages: PebPage[];\n}\n\n// TODO: move to a more suitable location\nexport enum ContextService {\n  Company = 'company',\n  Products = 'products',\n  Shipments = 'shipments',\n}\n\n// TODO: move to a more suitable location\nexport const CONTEXT_SERVICES = {\n  [ContextService.Company]: new InjectionToken<any>('ContextServices.Company'),\n  [ContextService.Products]: new InjectionToken<any>('ContextServices.Products'),\n  [ContextService.Shipments]: new InjectionToken<any>('ContextServices.Shipments'),\n};\n","export type PebElementId = string;\n\nexport enum PebElementType {\n  Document = 'document',\n  Section = 'section',\n  Block = 'block',\n  Text = 'text',\n  Image = 'image',\n  Product = 'product',\n  ProductPage = 'productPage',\n  Button = 'button',\n  Cart = 'cart',\n  Shape = 'shape',\n  Carousel = 'carousel',\n  Amount = 'amount',\n  Logo = 'logo',\n  Products = 'shop-products',\n  Line = 'line',\n}\n\nexport enum PebMakerType {\n  Text = 'text',\n}\n\nexport interface PebElement {\n  id: PebElementId;\n  type: PebElementType;\n  children?: PebElement[];\n  data?: {\n    text?: string;\n    routes?: any[];\n    [others: string]: any;\n  };\n  meta?: {\n    deletable: boolean;\n  };\n}\n\nexport enum PebElementContextState {\n  Loading = 'loading',\n  Error = 'error',\n  Ready = 'ready',\n  Empty = 'empty',\n}\n\nexport interface PebElementWithParent extends PebElement {\n  priority: number;\n  parentId: string | null;\n}\n\nexport type PebElementContext<T> = {\n  state: PebElementContextState.Loading;\n} | {\n  state: PebElementContextState.Error;\n} | {\n  state: PebElementContextState.Empty;\n} | {\n  state: PebElementContextState.Ready;\n  data: T;\n};\n","export enum PebScreen {\n  Desktop = 'desktop',\n  Tablet = 'tablet',\n  Mobile = 'mobile',\n}\n","import { OnDestroy } from '@angular/core';\nimport { ReplaySubject } from 'rxjs';\n\nexport abstract class AbstractComponent implements OnDestroy {\n\n  protected destroyed$ = new ReplaySubject<boolean>();\n\n  ngOnDestroy(): void {\n    this.destroyed$.next(true);\n    this.destroyed$.complete();\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { PebAction } from './models/action';\nimport { PebShop, PebShopId } from './models/client';\nimport { PebShopThemeVersionEntity } from './models/database';\nimport { PebShopThemeId, PebShopThemeVersionId } from './models/editor';\n\nexport interface CreateShopThemePayload {\n  name: string;\n  content: PebShop;\n}\n\nexport type CreateShopThemeDto = any;\n\nexport abstract class PebApiService {\n  abstract getShopThemesList(): Observable<any>;\n\n  abstract getShopThemeById(themeId: PebShopThemeId): Observable<any>;\n\n  abstract createShopTheme(input: CreateShopThemePayload): Observable<CreateShopThemeDto>;\n\n  abstract createShopThemeVersion(shopId: PebShopId, name: string): Observable<PebShopThemeVersionEntity>;\n\n  abstract deleteShopThemeVersion(shopId: PebShopId, versionId: PebShopThemeVersionId): Observable<any>;\n\n  abstract activateShopThemeVersion(shopId: PebShopId, versionId: PebShopThemeVersionId): Observable<CreateShopThemeDto>;\n\n  abstract publishShopThemeVersion(shopId: PebShopId, versionId: PebShopThemeVersionId): Observable<any>;\n\n  abstract addAction(shopId: PebShopId, action: PebAction): Observable<any>;\n\n  abstract getShopThemeVersions(shopId: PebShopId): Observable<PebShopThemeVersionEntity[]>;\n\n  abstract updateReplica(themeId: string, oldInitAction: PebAction, newInitAction: PebAction): Observable<any>;\n\n  abstract undoAction(themeId: string): Observable<any>;\n}\n","const root: any = (typeof self === 'object' && self.self === self && self) ||\n  (typeof global === 'object' && global.global === global && global) ||\n  this;\n\nexport function pebCreateLogger(namespace: string): (...a: unknown[]) => unknown[] {\n  const acceptableNss = [\n    ...namespace\n      .split(':')\n      .map((el, i, all) =>\n        [...all.slice(0, i), '*'].join(':'),\n      ),\n    namespace,\n  ];\n\n  if (root.PEB_DEBUG\n    && root.PEB_DEBUG.split(',').find(\n      eNs => acceptableNss.includes(eNs),\n    )\n  ) {\n    return (...input) => {\n      // tslint:disable-next-line:no-console\n      console.log(\n        `%c ${namespace} `, 'background: #3078a8; color: white',\n        ...input,\n      );\n\n      return [...input];\n    };\n  }\n\n  return (...input) => [...input];\n}\n","import { isArray, isFunction, merge } from 'lodash-es';\n\nimport { PebTemplate } from '../models/client';\nimport { PebElement, PebElementId, PebElementWithParent } from '../models/element';\n\nexport function pebMapElementDeep(\n  element: PebElement,\n  handler: (el: PebElement) => PebElement,\n): PebElement {\n  const { children: children = [], ...elementProps } = handler(element);\n\n  return {\n    ...merge({}, elementProps),\n    children: children.map(child => pebMapElementDeep(child, handler)),\n  };\n}\n\nexport function pebFilterElementDeep(\n  element: PebElement,\n  handler: (el: PebElement) => boolean,\n): PebTemplate | PebElement {\n  const nextChildren = element.children?.filter(handler);\n\n  return {\n    ...merge({}, element),\n    children: nextChildren?.map(child => pebFilterElementDeep(child, handler)),\n  };\n}\n\nexport function pebTraverseElementDeep(\n  element: PebElement,\n  handler: (el: PebElement) => any,\n): void {\n  handler(merge({}, element));\n\n  if (isArray(element.children)) {\n    element.children.forEach(el => pebTraverseElementDeep(el, handler));\n  }\n}\n\nexport function pebFindElementParents(document: PebElement, id: PebElementId): PebElement[] {\n  const stack = [{ node: document, i: 0 }];\n  while (stack.length) {\n    let current = stack[stack.length - 1];\n    while (current.i < current.node.children.length) {\n      const node = current.node.children[current.i];\n\n      if (node.id === id) {\n        return stack\n          .filter(el => el.node.id !== document.id)\n          .map(el => el.node);\n      }\n\n      stack.push({ node, i: 0 });\n      current.i++;\n      current = stack[stack.length - 1];\n    }\n\n    stack.pop();\n  }\n\n  return null;\n}\n\nexport function pebFindElementChildren(\n  element: PebElement,\n  predicate?: ((e: PebElement) => boolean),\n): PebElement[] {\n  if (predicate && !isFunction(predicate)) {\n    throw new Error('Unsupported selector');\n  }\n\n  predicate = predicate || (() => true); // tslint:disable-line\n\n  const result = [];\n\n  pebTraverseElementDeep(element, el => {\n    if (predicate(el)) {\n      result.push(el);\n    }\n  });\n\n  return result;\n}\n\nexport function pebTraverseElementDeepWithParent(\n  element: PebElement,\n  handler: (el: any) => any,\n  parentId: null | string = null,\n  priority: any = -1,\n): void {\n  const nextPriority = parseInt(priority, 10) + 1;\n  handler({ ...element, parentId, priority: nextPriority });\n\n  if (isArray(element.children)) {\n    element.children.forEach(el => pebTraverseElementDeepWithParent(el, handler, element.id, nextPriority));\n  }\n}\n\nexport function pebFindElementChildrenWithParent(\n  element: PebElement,\n  predicate: ((e: PebElement) => boolean) = (() => true),\n): PebElementWithParent[] {\n  if (predicate && !isFunction(predicate)) {\n    throw new Error('Unsupported selector');\n  }\n\n  const result = [];\n\n  pebTraverseElementDeepWithParent(element, el => {\n    if (predicate(el)) {\n      result.push(el);\n    }\n  });\n\n  return result;\n}\n","import { random } from 'lodash-es';\nimport { v4 as uuid } from 'uuid';\n\n// This will allow us to detect global object both in browser and in backend\n// so in sandbox we could generate more readable ids and at the same time use\n// normal ones in production\nconst root: any = (typeof self === 'object' && self.self === self && self) ||\n  (typeof global === 'object' && global.global === global && global) ||\n  this;\n\n// const initialNamespaces = localStorage.getItem('peb-ids');\n\n// const idsNamespaces: {\n//   [ns: string]: number,\n// } = initialNamespaces ? JSON.parse(initialNamespaces) : {};\n\nexport function pebGenerateId(ns?: string): string {\n  // if (root.PEB_CUSTOM_IDS && ns) {\n  //   if (!(ns in idsNamespaces)) {\n  //     idsNamespaces[ns] = 0;\n  //   }\n\n  //   idsNamespaces[ns]++;\n\n  //   localStorage.setItem('peb-ids', JSON.stringify(idsNamespaces));\n\n  //   return `${ns}-${idsNamespaces[ns]}`;\n  // }\n\n  if (root.PEB_CUSTOM_IDS) {\n    const base = 36;\n\n    return Number(random(0, base ** 5 - 1)).toString(base);\n  }\n\n  return uuid();\n}\n","import { merge, omit } from 'lodash-es';\n\nimport { PebContextSchemaEffect } from '../../models/action';\nimport { PebContextSchema } from '../../models/client';\n\nexport const pebContextSchemaEffectHandlers: {\n  [effectName in PebContextSchemaEffect]: (schema: null | PebContextSchema, payload: PebContextSchema | string) => PebContextSchema | null\n} = {\n  [PebContextSchemaEffect.Init]: pebContextSchemaEffectInitHandler,\n  [PebContextSchemaEffect.Update]: pebContextSchemaEffectUpdateHandler,\n  [PebContextSchemaEffect.Delete]: pebContextSchemaEffectDeleteHandler,\n};\n\nexport function pebContextSchemaEffectInitHandler(_: null, payload: PebContextSchema): PebContextSchema {\n  return payload;\n}\n\nexport function pebContextSchemaEffectUpdateHandler(prevSchema: PebContextSchema, payload: PebContextSchema): PebContextSchema {\n  return merge({}, prevSchema, payload);\n}\n\nexport function pebContextSchemaEffectDeleteHandler(prevSchema: PebContextSchema, payload: string): PebContextSchema {\n  return null;\n}\n","import { PebPageEffect } from '../../models/action';\nimport { PebPageShort } from '../../models/editor';\n\nexport const pebPageEffectHandler: {\n  [effectName in PebPageEffect]: (page: null | PebPageShort, payload: any) => PebPageShort | null\n} = {\n  [PebPageEffect.Create]: pebPageEffectCreateHandler,\n  [PebPageEffect.UpdateData]: pebPageEffectUpdateDataHandler,\n  [PebPageEffect.Delete]: pebPageEffectDeleteHandler,\n};\n\nexport function pebPageEffectCreateHandler(_: null, payload: PebPageShort): PebPageShort {\n  return payload;\n}\n\nexport function pebPageEffectUpdateDataHandler(prevPage: PebPageShort, payload: any): PebPageShort {\n  return {\n    ...prevPage,\n    data: { ...prevPage.data, ...payload },\n  };\n}\n\nexport function pebPageEffectDeleteHandler(prevPage: PebPageShort, payload: any): null {\n  return null;\n}\n","import { PebShopEffect } from '../../models/action';\nimport { PebPageId } from '../../models/client';\nimport { PebShopShort } from '../../models/editor';\n\nexport const pebShopEffectHandlers: {\n  [effectName in PebShopEffect]: (prevShop: null | PebShopShort, payload: any) => PebShopShort\n} = {\n  [PebShopEffect.Init]: pebShopEffectCreateHandler,\n  [PebShopEffect.UpdateData]: pebShopEffectUpdateDataHandler,\n  [PebShopEffect.UpdatePages]: pebShopEffectUpdatePagesHandler,\n  [PebShopEffect.AppendPage]: pebShopEffectAppendPagesHandler,\n  [PebShopEffect.DeletePage]: pebShopEffectAppendPagesHandler,\n};\n\nexport function pebShopEffectCreateHandler(prevShop: null, payload: PebShopShort): PebShopShort {\n  return payload;\n}\nexport function pebShopEffectUpdateDataHandler(prevShop: PebShopShort, payload: { [key: string]: any }): PebShopShort {\n  // debugger;\n  return {\n    ...prevShop,\n    data: {\n      ...prevShop.data,\n      ...payload,\n    },\n  };\n}\nexport function pebShopEffectUpdatePagesHandler(prevShop: PebShopShort, payload: PebPageId[]): PebShopShort {\n  return {\n    ...prevShop,\n    pageIds: payload,\n  };\n}\n\nexport function pebShopEffectAppendPagesHandler(prevShop: PebShopShort, payload: PebPageId): PebShopShort {\n  return {\n    ...prevShop,\n    pageIds: [...prevShop.pageIds, payload],\n  };\n}\n\nexport function pebShopEffectDeletePagesHandler(prevShop: PebShopShort, payload: PebPageId): PebShopShort {\n  return {\n    ...prevShop,\n    pageIds: prevShop.pageIds.filter(id => id !== payload),\n  };\n}\n","import { merge } from 'lodash-es';\n\nimport { PebStylesheetEffect } from '../../models/action';\nimport { PebStylesheet } from '../../models/client';\n\nexport const pebStylesheetEffectHandlers: {\n  [effectName in PebStylesheetEffect]: (\n    stylesheet: null | PebStylesheet,\n    payload: PebStylesheet | string,\n  ) => PebStylesheet | null\n} = {\n  [PebStylesheetEffect.Init]: pebStylesheetInitHandler,\n  [PebStylesheetEffect.Update]: pebStylesheetUpdateHandler,\n  [PebStylesheetEffect.Delete]: pebStylesheetDeleteHandler,\n};\n\nexport function pebStylesheetInitHandler(_: null, payload: PebStylesheet): PebStylesheet {\n  return payload;\n}\n\nexport function pebStylesheetUpdateHandler(prevState: PebStylesheet, payload: PebStylesheet): PebStylesheet {\n  return merge(\n    {},\n    prevState,\n    payload,\n  );\n}\n\nexport function pebStylesheetDeleteHandler(): PebStylesheet {\n  return null;\n}\n","import { PebTemplateEffect } from '../../models/action';\nimport { PebTemplate } from '../../models/client';\nimport { PebElement } from '../../models/element';\nimport { pebFilterElementDeep, pebMapElementDeep } from '../../utils/element-utils';\n\nexport const layoutsScopeName = 'layouts';\n\nexport interface PebAppendElementPayload {\n  to: string;\n  after?: string;\n  element: PebElement;\n}\n\nexport const pebLayoutEffectHandlers: {\n  [effectName in PebTemplateEffect]: (prevLayout: null| PebTemplate, payload: any) => PebTemplate | null\n} = {\n  [PebTemplateEffect.Init]: pebLayoutInitHandler,\n  [PebTemplateEffect.Destroy]: pebLayoutDestroyHandler,\n  [PebTemplateEffect.AppendElement]: pebLayoutAppendElementHandler,\n  [PebTemplateEffect.UpdateElement]: pebLayoutUpdateElementHandler,\n  [PebTemplateEffect.RelocateElement]: pebLayoutRelocateElementHandler,\n  [PebTemplateEffect.DeleteElement]: pebLayoutDeleteElementHandler,\n};\n\nexport function pebLayoutInitHandler(prevLayout: null, payload: PebTemplate) {\n  return payload;\n}\n\nexport function pebLayoutDestroyHandler(prevLayout: null | PebTemplate) {\n  return null;\n}\n\nexport function pebLayoutAppendElementHandler(prevLayout: PebTemplate, payload: PebAppendElementPayload): PebTemplate {\n  return pebMapElementDeep(\n    prevLayout,\n    el => (el.id === payload.to ? { ...el, children: [...el.children, payload.element] } : el),\n  ) as PebTemplate;\n}\n\nexport function pebLayoutUpdateElementHandler(prevLayout: PebTemplate, payload: any) {\n  throw new Error('To implement');\n  return prevLayout;\n}\n\nexport function pebLayoutRelocateElementHandler(prevLayout: PebTemplate, payload: any) {\n  throw new Error('To implement');\n  return prevLayout;\n}\n\nexport function pebLayoutDeleteElementHandler(prevLayout: PebTemplate, payload: string): PebTemplate {\n  return pebFilterElementDeep(prevLayout, c => c.id !== payload) as PebTemplate;\n}\n","import { omit } from 'lodash-es';\n\nimport { PebAction, PebEffectTarget } from '../models/action';\nimport { PebShopThemeSnapshotEntity } from '../models/database';\nimport { pebContextSchemaEffectHandlers } from './effects/context-schema.effects';\nimport { pebPageEffectHandler } from './effects/page.effects';\nimport { pebShopEffectHandlers } from './effects/shop.effects';\nimport { pebStylesheetEffectHandlers } from './effects/stylesheet.effects';\nimport { pebLayoutEffectHandlers } from './effects/template.effects';\n\nconst createInitialShopSnapshot = (): PebShopThemeSnapshotEntity => ({\n  // TODO: is hash needed???\n  id: null,\n  shop: null,\n  pages: {},\n  templates: {},\n  stylesheets: {},\n  contextSchemas: {},\n});\n\nconst effectHandlers = {\n  ...pebShopEffectHandlers,\n  ...pebPageEffectHandler,\n  ...pebLayoutEffectHandlers,\n  ...pebStylesheetEffectHandlers,\n  ...pebContextSchemaEffectHandlers,\n};\n\nexport function pebActionHandler(input: PebShopThemeSnapshotEntity, action: PebAction): PebShopThemeSnapshotEntity {\n  return action.effects.reduce((prevState, effect) => {\n    const [areaName, areaId] = effect.target.split(':') as [ string, string ];\n    const handler = effectHandlers[effect.type];\n\n    if (!handler) {\n      throw new Error('Invalid effect type');\n    }\n\n    const collectionNames = Object.values(PebEffectTarget) as string[];\n\n    // TODO: Check if Maps are deeply copied\n    if (areaName === PebEffectTarget.Shop) {\n      // debugger;\n      return {\n        ...prevState,\n        shop: handler(prevState.shop as any, effect.payload),\n      } as any; // FIXME: Type??\n    } else if (collectionNames.includes(areaName)) {\n      const prevUnit = prevState[areaName][areaId] || null;\n      const nextUnit = handler(prevUnit, effect.payload);\n\n      const nextArea = Boolean(nextUnit)\n        ? { ...prevState[areaName], [areaId]: nextUnit }\n        : omit(prevState[areaName], areaId) as any;\n\n      return {\n        ...prevState,\n        [areaName]: nextArea,\n      };\n    }\n\n    throw new Error('Invalid effect target');\n  }, input);\n}\n\nexport const pebCompileActions = (actions: PebAction[]): PebShopThemeSnapshotEntity =>\n  actions.reduce(pebActionHandler, createInitialShopSnapshot());\n","import { PebScreen } from '../constants';\nimport { PebPage, PebPageType, PebPageVariant, PebShop, PebTemplate } from '../models/client';\nimport { PebElementType } from '../models/element';\nimport { pebGenerateId } from '../utils/generate-id';\nimport { random } from 'lodash-es';\n\nexport const pebCreateEmptyPage = (name, type: PebPageType = PebPageType.Replica, variant = PebPageVariant.Default): PebPage => {\n\n  const line = {\n    id: pebGenerateId(),\n    type: PebElementType.Line,\n  };\n\n  const template: PebTemplate = {\n    id: pebGenerateId('element'),\n    type: PebElementType.Document,\n    children: ['header', 'body', 'footer'].map(sectionName => ({\n      id: pebGenerateId('element'),\n      type: PebElementType.Section,\n      data: { name: sectionName },\n      meta: { deletable: false },\n      children: [\n        ...(sectionName === 'header' ? [\n          {\n            id: pebGenerateId('element'),\n            type: PebElementType.Block,\n            children: [\n              {\n                id: pebGenerateId('element'),\n                type: PebElementType.Text,\n                data: {\n                  text: name,\n                },\n              },\n            ],\n          },\n        ] : []),\n      ],\n    })),\n  };\n\n  const [headerId, bodyId, footerId] = template.children.map(el => el.id);\n  const headerBlockId = template.children[0].children[0].id;\n  const blockColor = '#' + Number(random(0, 16 ** 6)).toString(16);\n\n  return  {\n    id: pebGenerateId('page'),\n    name,\n    type,\n    variant,\n    master: null,\n    data: {\n      url: '/',\n      mark: null,\n    },\n    template,\n    stylesheets: {\n      [PebScreen.Desktop]: {\n        [headerId]: { height: 200 },\n        [bodyId]: { height: 600 },\n        [footerId]: { height: 200 },\n        [headerBlockId]: {\n          height: 150,\n          width: 150,\n          backgroundColor: blockColor,\n        },\n        [line.id]: {height: 2},\n      },\n      [PebScreen.Tablet]: {\n        [headerId]: { height: 200 },\n        [bodyId]: { height: 600 },\n        [footerId]: { height: 200 },\n        [headerBlockId]: {\n          height: 150,\n          width: 150,\n          backgroundColor: blockColor,\n        },\n        [line.id]: {height: 2},\n      },\n      [PebScreen.Mobile]: {\n        [headerId]: { height: 200 },\n        [bodyId]: { height: 600 },\n        [footerId]: { height: 200 },\n        [headerBlockId]: {\n          height: 150,\n          width: 150,\n          backgroundColor: blockColor,\n        },\n        [line.id]: {height: 2},\n      },\n    },\n    context: {},\n  };\n};\n\nexport function pebCreateEmptyShop(): PebShop {\n  const frontPage = pebCreateEmptyPage('Front');\n\n  return {\n    id: pebGenerateId(),\n    data: {\n      frontPageId: frontPage.id,\n    },\n    routing: {\n      '/': frontPage.id,\n    },\n    context: {},\n    pages: [frontPage],\n  };\n}\n","import { ContextSchemaItem, PebContextSchema, PebElementStyles } from '../models/client';\nimport { PebElement, PebElementType } from '../models/element';\nimport { pebGenerateId } from '../utils/generate-id';\n\ntype ElementPayload = Partial<PebElement> & ({ type: PebElementType });\n\nexport interface PebElementKit {\n  element: PebElement;\n  styles: { [screenId: string]: PebElementStyles };\n  contextSchema: PebContextSchema;\n}\n\n// TODO: Delete after 25.04 if not used\nexport const pebCreateElementKit = (\n  elementPayload: ElementPayload,\n  styles?: { [screen: string]: PebElementStyles },\n  contextItem?: ContextSchemaItem,\n): PebElementKit => {\n  const element = {\n    ...elementPayload,\n    id: pebGenerateId(),\n  };\n\n  return {\n    element,\n    styles,\n    contextSchema: {\n      [element.id]: contextItem,\n    },\n  };\n};\n","import { PebScreen } from '../constants';\nimport {\n  PebAction,\n  PebContextSchemaEffect,\n  PebEffectTarget,\n  PebPageEffect,\n  PebShopEffect,\n  PebStylesheetEffect,\n  PebTemplateEffect,\n} from '../models/action';\nimport { PebShop } from '../models/client';\nimport { pebGenerateId } from '../utils/generate-id';\n\n// TODO: Properly handle shop with multiple pages\nexport const pebCreateShopInitAction = (shop: PebShop): PebAction => {\n  const page = shop.pages[0];\n\n  const shopContextId = pebGenerateId('context');\n\n  const pageTemplateId = pebGenerateId('template');\n  const stylesIds = {\n    [PebScreen.Desktop]: pebGenerateId('stylesheet'),\n    [PebScreen.Tablet]: pebGenerateId('stylesheet'),\n    [PebScreen.Mobile]: pebGenerateId('stylesheet'),\n  };\n  const pageContextId = pebGenerateId('context');\n\n  return {\n    id: pebGenerateId('action'),\n    createdAt: new Date(),\n    effects: [\n      {\n        type: PebTemplateEffect.Init,\n        target: `${PebEffectTarget.Templates}:${pageTemplateId}`,\n        payload: page.template,\n      },\n      ...Object.values(PebScreen).map(screen => ({\n        type: PebStylesheetEffect.Init,\n        target: `${PebEffectTarget.Stylesheets}:${stylesIds[screen]}`,\n        payload: page.stylesheets[screen],\n      })),\n      {\n        type: PebContextSchemaEffect.Init,\n        target: `${PebEffectTarget.ContextSchemas}:${pageContextId}`,\n        payload: page.context,\n      },\n      {\n        type: PebPageEffect.Create,\n        target: `${PebEffectTarget.Pages}:${page.id}`,\n        payload: {\n          id: page.id,\n          type: page.type,\n          variant: page.variant,\n          master: page.master,\n          name: page.name,\n          data: page.data,\n          templateId: pageTemplateId,\n          stylesheetIds: {\n            [PebScreen.Desktop]: `${stylesIds[PebScreen.Desktop]}`,\n            [PebScreen.Tablet]: `${stylesIds[PebScreen.Tablet]}`,\n            [PebScreen.Mobile]: `${stylesIds[PebScreen.Mobile]}`,\n          },\n          contextId: `${pageContextId}`,\n        },\n      },\n      {\n        type: PebContextSchemaEffect.Init,\n        target: `${PebEffectTarget.ContextSchemas}:${shopContextId}`,\n        payload: {},\n      },\n      {\n        type: PebShopEffect.Init,\n        target: PebEffectTarget.Shop,\n        payload: {\n          data: {\n            frontPageId: page.id,\n          },\n          contextId: shopContextId,\n          pageIds: [page.id],\n        },\n      },\n    ],\n  };\n};\n"]}