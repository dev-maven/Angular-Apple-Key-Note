import { __assign, __rest } from "tslib";
import { isArray, isFunction, merge } from 'lodash-es';
export function pebMapElementDeep(element, handler) {
    var _a = handler(element), _b = _a.children, children = _b === void 0 ? [] : _b, elementProps = __rest(_a, ["children"]);
    return __assign(__assign({}, merge({}, elementProps)), { children: children.map(function (child) { return pebMapElementDeep(child, handler); }) });
}
export function pebFilterElementDeep(element, handler) {
    var _a, _b;
    var nextChildren = (_a = element.children) === null || _a === void 0 ? void 0 : _a.filter(handler);
    return __assign(__assign({}, merge({}, element)), { children: (_b = nextChildren) === null || _b === void 0 ? void 0 : _b.map(function (child) { return pebFilterElementDeep(child, handler); }) });
}
export function pebTraverseElementDeep(element, handler) {
    handler(merge({}, element));
    if (isArray(element.children)) {
        element.children.forEach(function (el) { return pebTraverseElementDeep(el, handler); });
    }
}
export function pebFindElementParents(document, id) {
    var stack = [{ node: document, i: 0 }];
    while (stack.length) {
        var current = stack[stack.length - 1];
        while (current.i < current.node.children.length) {
            var node = current.node.children[current.i];
            if (node.id === id) {
                return stack
                    .filter(function (el) { return el.node.id !== document.id; })
                    .map(function (el) { return el.node; });
            }
            stack.push({ node: node, i: 0 });
            current.i++;
            current = stack[stack.length - 1];
        }
        stack.pop();
    }
    return null;
}
export function pebFindElementChildren(element, predicate) {
    if (predicate && !isFunction(predicate)) {
        throw new Error('Unsupported selector');
    }
    predicate = predicate || (function () { return true; }); // tslint:disable-line
    var result = [];
    pebTraverseElementDeep(element, function (el) {
        if (predicate(el)) {
            result.push(el);
        }
    });
    return result;
}
export function pebTraverseElementDeepWithParent(element, handler, parentId, priority) {
    if (parentId === void 0) { parentId = null; }
    if (priority === void 0) { priority = -1; }
    var nextPriority = parseInt(priority, 10) + 1;
    handler(__assign(__assign({}, element), { parentId: parentId, priority: nextPriority }));
    if (isArray(element.children)) {
        element.children.forEach(function (el) { return pebTraverseElementDeepWithParent(el, handler, element.id, nextPriority); });
    }
}
export function pebFindElementChildrenWithParent(element, predicate) {
    if (predicate === void 0) { predicate = (function () { return true; }); }
    if (predicate && !isFunction(predicate)) {
        throw new Error('Unsupported selector');
    }
    var result = [];
    pebTraverseElementDeepWithParent(element, function (el) {
        if (predicate(el)) {
            result.push(el);
        }
    });
    return result;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC11dGlscy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BwZS9idWlsZGVyLWNvcmUvIiwic291cmNlcyI6WyJ1dGlscy9lbGVtZW50LXV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFLdkQsTUFBTSxVQUFVLGlCQUFpQixDQUMvQixPQUFtQixFQUNuQixPQUF1QztJQUV2QyxJQUFNLHFCQUErRCxFQUE3RCxnQkFBdUIsRUFBdkIsa0NBQXVCLEVBQUUsdUNBQW9DLENBQUM7SUFFdEUsNkJBQ0ssS0FBSyxDQUFDLEVBQUUsRUFBRSxZQUFZLENBQUMsS0FDMUIsUUFBUSxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLEVBQWpDLENBQWlDLENBQUMsSUFDbEU7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLG9CQUFvQixDQUNsQyxPQUFtQixFQUNuQixPQUFvQzs7SUFFcEMsSUFBTSxZQUFZLFNBQUcsT0FBTyxDQUFDLFFBQVEsMENBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRXZELDZCQUNLLEtBQUssQ0FBQyxFQUFFLEVBQUUsT0FBTyxDQUFDLEtBQ3JCLFFBQVEsUUFBRSxZQUFZLDBDQUFFLEdBQUcsQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLG9CQUFvQixDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsRUFBcEMsQ0FBb0MsS0FDekU7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLHNCQUFzQixDQUNwQyxPQUFtQixFQUNuQixPQUFnQztJQUVoQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBRTVCLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtRQUM3QixPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFBLEVBQUUsSUFBSSxPQUFBLHNCQUFzQixDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBbkMsQ0FBbUMsQ0FBQyxDQUFDO0tBQ3JFO0FBQ0gsQ0FBQztBQUVELE1BQU0sVUFBVSxxQkFBcUIsQ0FBQyxRQUFvQixFQUFFLEVBQWdCO0lBQzFFLElBQU0sS0FBSyxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3pDLE9BQU8sS0FBSyxDQUFDLE1BQU0sRUFBRTtRQUNuQixJQUFJLE9BQU8sR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN0QyxPQUFPLE9BQU8sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFO1lBQy9DLElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUU5QyxJQUFJLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFO2dCQUNsQixPQUFPLEtBQUs7cUJBQ1QsTUFBTSxDQUFDLFVBQUEsRUFBRSxJQUFJLE9BQUEsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssUUFBUSxDQUFDLEVBQUUsRUFBMUIsQ0FBMEIsQ0FBQztxQkFDeEMsR0FBRyxDQUFDLFVBQUEsRUFBRSxJQUFJLE9BQUEsRUFBRSxDQUFDLElBQUksRUFBUCxDQUFPLENBQUMsQ0FBQzthQUN2QjtZQUVELEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLE1BQUEsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMzQixPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDWixPQUFPLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDbkM7UUFFRCxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7S0FDYjtJQUVELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELE1BQU0sVUFBVSxzQkFBc0IsQ0FDcEMsT0FBbUIsRUFDbkIsU0FBd0M7SUFFeEMsSUFBSSxTQUFTLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUU7UUFDdkMsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0tBQ3pDO0lBRUQsU0FBUyxHQUFHLFNBQVMsSUFBSSxDQUFDLGNBQU0sT0FBQSxJQUFJLEVBQUosQ0FBSSxDQUFDLENBQUMsQ0FBQyxzQkFBc0I7SUFFN0QsSUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDO0lBRWxCLHNCQUFzQixDQUFDLE9BQU8sRUFBRSxVQUFBLEVBQUU7UUFDaEMsSUFBSSxTQUFTLENBQUMsRUFBRSxDQUFDLEVBQUU7WUFDakIsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUNqQjtJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQztBQUVELE1BQU0sVUFBVSxnQ0FBZ0MsQ0FDOUMsT0FBbUIsRUFDbkIsT0FBeUIsRUFDekIsUUFBOEIsRUFDOUIsUUFBa0I7SUFEbEIseUJBQUEsRUFBQSxlQUE4QjtJQUM5Qix5QkFBQSxFQUFBLFlBQWlCLENBQUM7SUFFbEIsSUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDaEQsT0FBTyx1QkFBTSxPQUFPLEtBQUUsUUFBUSxVQUFBLEVBQUUsUUFBUSxFQUFFLFlBQVksSUFBRyxDQUFDO0lBRTFELElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtRQUM3QixPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFBLEVBQUUsSUFBSSxPQUFBLGdDQUFnQyxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLEVBQUUsRUFBRSxZQUFZLENBQUMsRUFBdkUsQ0FBdUUsQ0FBQyxDQUFDO0tBQ3pHO0FBQ0gsQ0FBQztBQUVELE1BQU0sVUFBVSxnQ0FBZ0MsQ0FDOUMsT0FBbUIsRUFDbkIsU0FBc0Q7SUFBdEQsMEJBQUEsRUFBQSxhQUEyQyxjQUFNLE9BQUEsSUFBSSxFQUFKLENBQUksQ0FBQztJQUV0RCxJQUFJLFNBQVMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRTtRQUN2QyxNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7S0FDekM7SUFFRCxJQUFNLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFFbEIsZ0NBQWdDLENBQUMsT0FBTyxFQUFFLFVBQUEsRUFBRTtRQUMxQyxJQUFJLFNBQVMsQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ2pCO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNBcnJheSwgaXNGdW5jdGlvbiwgbWVyZ2UgfSBmcm9tICdsb2Rhc2gtZXMnO1xuXG5pbXBvcnQgeyBQZWJUZW1wbGF0ZSB9IGZyb20gJy4uL21vZGVscy9jbGllbnQnO1xuaW1wb3J0IHsgUGViRWxlbWVudCwgUGViRWxlbWVudElkLCBQZWJFbGVtZW50V2l0aFBhcmVudCB9IGZyb20gJy4uL21vZGVscy9lbGVtZW50JztcblxuZXhwb3J0IGZ1bmN0aW9uIHBlYk1hcEVsZW1lbnREZWVwKFxuICBlbGVtZW50OiBQZWJFbGVtZW50LFxuICBoYW5kbGVyOiAoZWw6IFBlYkVsZW1lbnQpID0+IFBlYkVsZW1lbnQsXG4pOiBQZWJFbGVtZW50IHtcbiAgY29uc3QgeyBjaGlsZHJlbjogY2hpbGRyZW4gPSBbXSwgLi4uZWxlbWVudFByb3BzIH0gPSBoYW5kbGVyKGVsZW1lbnQpO1xuXG4gIHJldHVybiB7XG4gICAgLi4ubWVyZ2Uoe30sIGVsZW1lbnRQcm9wcyksXG4gICAgY2hpbGRyZW46IGNoaWxkcmVuLm1hcChjaGlsZCA9PiBwZWJNYXBFbGVtZW50RGVlcChjaGlsZCwgaGFuZGxlcikpLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGViRmlsdGVyRWxlbWVudERlZXAoXG4gIGVsZW1lbnQ6IFBlYkVsZW1lbnQsXG4gIGhhbmRsZXI6IChlbDogUGViRWxlbWVudCkgPT4gYm9vbGVhbixcbik6IFBlYlRlbXBsYXRlIHwgUGViRWxlbWVudCB7XG4gIGNvbnN0IG5leHRDaGlsZHJlbiA9IGVsZW1lbnQuY2hpbGRyZW4/LmZpbHRlcihoYW5kbGVyKTtcblxuICByZXR1cm4ge1xuICAgIC4uLm1lcmdlKHt9LCBlbGVtZW50KSxcbiAgICBjaGlsZHJlbjogbmV4dENoaWxkcmVuPy5tYXAoY2hpbGQgPT4gcGViRmlsdGVyRWxlbWVudERlZXAoY2hpbGQsIGhhbmRsZXIpKSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBlYlRyYXZlcnNlRWxlbWVudERlZXAoXG4gIGVsZW1lbnQ6IFBlYkVsZW1lbnQsXG4gIGhhbmRsZXI6IChlbDogUGViRWxlbWVudCkgPT4gYW55LFxuKTogdm9pZCB7XG4gIGhhbmRsZXIobWVyZ2Uoe30sIGVsZW1lbnQpKTtcblxuICBpZiAoaXNBcnJheShlbGVtZW50LmNoaWxkcmVuKSkge1xuICAgIGVsZW1lbnQuY2hpbGRyZW4uZm9yRWFjaChlbCA9PiBwZWJUcmF2ZXJzZUVsZW1lbnREZWVwKGVsLCBoYW5kbGVyKSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBlYkZpbmRFbGVtZW50UGFyZW50cyhkb2N1bWVudDogUGViRWxlbWVudCwgaWQ6IFBlYkVsZW1lbnRJZCk6IFBlYkVsZW1lbnRbXSB7XG4gIGNvbnN0IHN0YWNrID0gW3sgbm9kZTogZG9jdW1lbnQsIGk6IDAgfV07XG4gIHdoaWxlIChzdGFjay5sZW5ndGgpIHtcbiAgICBsZXQgY3VycmVudCA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdO1xuICAgIHdoaWxlIChjdXJyZW50LmkgPCBjdXJyZW50Lm5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICBjb25zdCBub2RlID0gY3VycmVudC5ub2RlLmNoaWxkcmVuW2N1cnJlbnQuaV07XG5cbiAgICAgIGlmIChub2RlLmlkID09PSBpZCkge1xuICAgICAgICByZXR1cm4gc3RhY2tcbiAgICAgICAgICAuZmlsdGVyKGVsID0+IGVsLm5vZGUuaWQgIT09IGRvY3VtZW50LmlkKVxuICAgICAgICAgIC5tYXAoZWwgPT4gZWwubm9kZSk7XG4gICAgICB9XG5cbiAgICAgIHN0YWNrLnB1c2goeyBub2RlLCBpOiAwIH0pO1xuICAgICAgY3VycmVudC5pKys7XG4gICAgICBjdXJyZW50ID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07XG4gICAgfVxuXG4gICAgc3RhY2sucG9wKCk7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBlYkZpbmRFbGVtZW50Q2hpbGRyZW4oXG4gIGVsZW1lbnQ6IFBlYkVsZW1lbnQsXG4gIHByZWRpY2F0ZT86ICgoZTogUGViRWxlbWVudCkgPT4gYm9vbGVhbiksXG4pOiBQZWJFbGVtZW50W10ge1xuICBpZiAocHJlZGljYXRlICYmICFpc0Z1bmN0aW9uKHByZWRpY2F0ZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIHNlbGVjdG9yJyk7XG4gIH1cblxuICBwcmVkaWNhdGUgPSBwcmVkaWNhdGUgfHwgKCgpID0+IHRydWUpOyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lXG5cbiAgY29uc3QgcmVzdWx0ID0gW107XG5cbiAgcGViVHJhdmVyc2VFbGVtZW50RGVlcChlbGVtZW50LCBlbCA9PiB7XG4gICAgaWYgKHByZWRpY2F0ZShlbCkpIHtcbiAgICAgIHJlc3VsdC5wdXNoKGVsKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwZWJUcmF2ZXJzZUVsZW1lbnREZWVwV2l0aFBhcmVudChcbiAgZWxlbWVudDogUGViRWxlbWVudCxcbiAgaGFuZGxlcjogKGVsOiBhbnkpID0+IGFueSxcbiAgcGFyZW50SWQ6IG51bGwgfCBzdHJpbmcgPSBudWxsLFxuICBwcmlvcml0eTogYW55ID0gLTEsXG4pOiB2b2lkIHtcbiAgY29uc3QgbmV4dFByaW9yaXR5ID0gcGFyc2VJbnQocHJpb3JpdHksIDEwKSArIDE7XG4gIGhhbmRsZXIoeyAuLi5lbGVtZW50LCBwYXJlbnRJZCwgcHJpb3JpdHk6IG5leHRQcmlvcml0eSB9KTtcblxuICBpZiAoaXNBcnJheShlbGVtZW50LmNoaWxkcmVuKSkge1xuICAgIGVsZW1lbnQuY2hpbGRyZW4uZm9yRWFjaChlbCA9PiBwZWJUcmF2ZXJzZUVsZW1lbnREZWVwV2l0aFBhcmVudChlbCwgaGFuZGxlciwgZWxlbWVudC5pZCwgbmV4dFByaW9yaXR5KSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBlYkZpbmRFbGVtZW50Q2hpbGRyZW5XaXRoUGFyZW50KFxuICBlbGVtZW50OiBQZWJFbGVtZW50LFxuICBwcmVkaWNhdGU6ICgoZTogUGViRWxlbWVudCkgPT4gYm9vbGVhbikgPSAoKCkgPT4gdHJ1ZSksXG4pOiBQZWJFbGVtZW50V2l0aFBhcmVudFtdIHtcbiAgaWYgKHByZWRpY2F0ZSAmJiAhaXNGdW5jdGlvbihwcmVkaWNhdGUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVbnN1cHBvcnRlZCBzZWxlY3RvcicpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gW107XG5cbiAgcGViVHJhdmVyc2VFbGVtZW50RGVlcFdpdGhQYXJlbnQoZWxlbWVudCwgZWwgPT4ge1xuICAgIGlmIChwcmVkaWNhdGUoZWwpKSB7XG4gICAgICByZXN1bHQucHVzaChlbCk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gcmVzdWx0O1xufVxuIl19