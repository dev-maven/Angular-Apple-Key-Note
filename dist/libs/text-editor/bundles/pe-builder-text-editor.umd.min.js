!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/platform-browser"),require("@angular/common")):"function"==typeof define&&define.amd?define("@pe/builder-text-editor",["exports","@angular/core","rxjs","rxjs/operators","@angular/platform-browser","@angular/common"],t):t(((e=e||self).pe=e.pe||{},e.pe["builder-text-editor"]={}),e.ng.core,e.rxjs,e.rxjs.operators,e.ng.platformBrowser,e.ng.common)}(this,(function(e,t,n,r,i,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function u(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var c="attachShadow"in Element.prototype&&"getRootNode"in Element.prototype,s=!(!c||!document.createElement("div").attachShadow({mode:"open"}).getSelection),l=window.ShadyDOM&&window.ShadyDOM.inUse,f=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,d=!c||l||!s&&!f,p=[Node.ELEMENT_NODE,Node.TEXT_NODE,Node.DOCUMENT_FRAGMENT_NODE];function m(e,t,n){var r,i=t.childNodes||t.children;if(!i)return t;for(var o=0;o<i.length;++o){var a=i[n?o:i.length-1-o];if((r=a,p.includes(r.nodeType))&&e.containsNode(a,!0))return e.containsNode(a,!1)?a:m(e,a,n)}return t}var h=function(){if(s||d)return document.addEventListener("selectionchange",(function(e){document.dispatchEvent(new CustomEvent("-shadow-selectionchange"))})),function(){};var e=!1,t=[];return document.addEventListener("selectionchange",(function(n){e||(document.dispatchEvent(new CustomEvent("-shadow-selectionchange")),e=!0,window.setTimeout((function(){e=!1}),0),t.forEach((function(e){return e(n)})))})),function(e){return t.push(e)}}(),g=!1,y=null;function v(e,t,n){for(var r=t;(t=b(t,n))&&t.contains(r););return!!t&&(t instanceof Element&&e.containsNode(t,!0))}function b(e,t){if(!t)return e.previousSibling||e.parentNode||null;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}function x(e){return e.nodeType!==Node.TEXT_NODE?0:/^\s*/.exec(e.textContent)[0].length}h((function(e){"Caret"===window.getSelection().type?g=!0:g&&!y&&(y=Promise.resolve(!0).then((function(){g=!1,y=null})))}));var j=new Map;function C(e){if(s||d){var t=(d?document:e).getSelection();return t.rangeCount?t.getRangeAt(0):null}var n=j.get(e);if(n)return n;var r=window.getSelection().toString(),i=function(e){var t=document.createRange(),n=window.getSelection();e.insertBefore(S,e.childNodes[0]);var r=n.containsNode(S);if(S.remove(),r)return{range:null,mode:"outside-before"};e.appendChild(S);var i=n.containsNode(S);if(S.remove(),i)return{range:null,mode:"outside-after"};var o=function(){return n.toString().length};n.toString();if("Caret"!==n.type&&"Range"!==n.type)return{range:null,mode:"outside-after"};n.type;var a,u=m(n,e,!0),c=void 0;"Range"===n.type&&(a=m(n,e,!1),c=function(e,t,n){if("Range"===e.type){var r,i=function(){return e.toString().length},o=i();return 1===o&&g&&t===n?(e.extend(t,0),void e.collapseToEnd()):(e.modify("extend","forward","character"),(r=i())>o||v(e,n,!0)?(e.modify("extend","backward","character"),!0):r<o||!e.containsNode(t)?(e.modify("extend","backward","character"),!1):(e.modify("extend","backward","character"),(r=i())>o||v(e,t,!1)?(e.modify("extend","forward","character"),!1):r<o||!e.containsNode(n)?(e.modify("extend","forward","character"),!0):void 0))}}(n,u,a));if("Caret"===n.type){n.extend(u,0);var s=o();return n.collapseToEnd(),t.setStart(u,s),t.setEnd(u,s),{range:t,mode:"caret"}}if(void 0===c){if("Range"!==n.type)throw new TypeError("unexpected type: "+n.type);return t.setStart(u,0),t.setEnd(a,a.length),{range:t,mode:"all"}}var l,f,d=o(),p=a.length-function(e){if(e.nodeType!==Node.TEXT_NODE)return 0;var t=/\s*$/.exec(e.textContent)[0].length;return t?t-1:0}(a);c?(n.extend(u,0),l=o()+x(u),n.extend(a,p),f=p-(o()-d),n.extend(a,f)):(n.extend(a,p),f=p-o(),n.extend(u,0),l=o()-d+x(u),n.extend(u,l));0;return t.setStart(u,l),t.setEnd(a,f),{mode:c?"right":"left",range:t}}(e),o=i.range&&i.range.toString()||null;return null!==o&&o!==r&&o.replace(/\s/g,"")!==r.replace(/\s/g,"")&&(console.warn("invalid range, initial text:",r),console.warn("vs",o,i.mode,i.range)),j.set(e,i.range),window.setTimeout((function(){j.delete(e)}),0),i.range}var S=document.createTextNode("");var E,T=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,w=function(){function e(){}return e.prototype.get=function(e){if(!e)return document.getSelection().removeAllRanges(),null;var t=C(document.querySelector("pe-editor-canvas").shadowRoot);if(!t)return null;var n=t.cloneRange();n.selectNodeContents(e),n.setEnd(t.startContainer,t.startOffset);var r=n.toString().length;return{start:r,end:r+t.toString().length,range:t,container:e,parentElement:t.endContainer.parentElement}},e.prototype.restore=function(e){if(e){var t=e.container.ownerDocument,n=t.defaultView,r=t.createRange();r.setStart(e.container,0),r.collapse(!0);for(var i,o=[e.container],a=!1,u=!1,c=0;!u&&(i=o.pop());)if(3==i.nodeType){var s=c+i.length;!a&&e.start>=c&&e.start<=s&&(r.setStart(i,e.start-c),a=!0),a&&e.end>=c&&e.end<=s&&(r.setEnd(i,e.end-c),u=!0),c=s}else for(var l=i.childNodes.length;l--;)o.push(i.childNodes[l]);var f=n.getSelection();f.removeAllRanges(),f.addRange(r)}},e.prototype.findParentTag=function(e,t,n,r){void 0===r&&(r=10);var i=null;return e&&e.anchorNode&&e.focusNode?([e.anchorNode,e.focusNode].forEach((function(e){for(var o=r;o>0&&e.parentNode&&(t&&e.tagName!==t||(i=e,n&&e.classList&&!e.classList.contains(n)&&(i=null),!i));)e=e.parentNode,o--})),i):null},e}(),$=function(){function e(e){this.selectionHelper=e,this.savedValueSubject=new n.BehaviorSubject(null),this.savedValue$=this.savedValueSubject.asObservable().pipe(r.share())}return Object.defineProperty(e.prototype,"savedValue",{get:function(){return this.savedValueSubject.value},set:function(e){this.savedValueSubject.next(e)},enumerable:!0,configurable:!0}),e.prototype.saveSelection=function(e){this.savedValue=e},e.prototype.getSelection=function(e){return this.selectionHelper.get(e)},e.prototype.restore=function(){this.selectionHelper.restore(this.savedValue)},e.prototype.expandToTag=function(e){},e.prototype.findParentTag=function(e){if(!this.savedValue)return null;for(var t=this.savedValue.range.endContainer.parentElement;t&&t.tagName!==e&&"DIV"!==t.tagName;)t=t.parentElement;return t},e.ɵfac=function(n){return new(n||e)(t["ɵɵinject"](w))},e.ɵprov=t["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac}),e}();(E=e.ExecCommand||(e.ExecCommand={})).CreateLink="createLink",E.Unlink="unlink",E.Bold="bold",E.Italic="italic",E.Underline="underline",E.FontName="fontName",E.FontSize="fontSize",E.ForeColor="foreColor",E.InsertHTML="insertHTML",E.InsertText="insertText",E.JustifyLeft="justifyLeft",E.JustifyRight="justifyRight",E.JustifyCenter="justifyCenter",E.JustifyFull="justifyFull",E.InsertOrderedList="insertOrderedList",E.InsertUnorderedList="insertUnorderedList";var O=function(){function e(){}return e.prototype.execCommand=function(e,t){document.execCommand(e,!1,t)},Object.defineProperty(e.prototype,"isSelectionExist",{get:function(){return"none"!==window.getSelection().type.toLowerCase()},enumerable:!0,configurable:!0}),e}(),k=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),r.prototype.toggle=function(){this.execCommand(e.ExecCommand.Bold)},Object.defineProperty(r.prototype,"value",{get:function(){return!!this.isSelectionExist&&document.queryCommandState(e.ExecCommand.Bold)},enumerable:!0,configurable:!0}),r.ɵfac=function(e){return L(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),L=t["ɵɵgetInheritedFactory"](k),P=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),Object.defineProperty(r.prototype,"value",{get:function(){return document.queryCommandValue(e.ExecCommand.ForeColor)},set:function(t){this.execCommand(e.ExecCommand.ForeColor,t)},enumerable:!0,configurable:!0}),r.ɵfac=function(e){return I(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),I=t["ɵɵgetInheritedFactory"](P),N=function(n){function r(e){var t=n.call(this)||this;return t.selection=e,t}return u(r,n),Object.defineProperty(r.prototype,"value",{get:function(){if(!this.selection.savedValue)return null;var e=this.getParentLinkElement();return e&&e.hasAttribute("href")?e.getAttribute("href"):null},set:function(e){e?this.link(e):this.unlink()},enumerable:!0,configurable:!0}),r.prototype.link=function(t){this.execCommand(e.ExecCommand.CreateLink,this.getLinkWithHttps(t)),this.selection.saveSelection(this.selection.getSelection(this.selection.savedValue.container)),this.getParentLinkElement().setAttribute("target","_blank")},r.prototype.getParentLinkElement=function(){for(var e=this.selection.savedValue.parentElement;e&&"A"!==e.tagName;)e=e.parentElement;return e},r.prototype.getLinkWithHttps=function(e){return-1===e.indexOf("://")&&-1===e.indexOf("mailto:")?"https://"+e:e},r.prototype.unlink=function(){this.execCommand(e.ExecCommand.Unlink)},r.ɵfac=function(e){return new(e||r)(t["ɵɵinject"]($))},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),A=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),Object.defineProperty(r.prototype,"value",{get:function(){var t=document.queryCommandValue(e.ExecCommand.FontName);return t?t.replace(/['"]+/g,""):null},set:function(t){this.execCommand(e.ExecCommand.FontName,t)},enumerable:!0,configurable:!0}),r.ɵfac=function(e){return F(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),F=t["ɵɵgetInheritedFactory"](A),U=function(e){function n(t){var n=e.call(this)||this;return n.selection=t,n}return u(n,e),Object.defineProperty(n.prototype,"value",{get:function(){if(!this.selection.savedValue)return null;for(var e=this.selection.savedValue.parentElement;e&&"SPAN"!==e.tagName&&!e.style.fontSize;)e=e.parentElement;var t=e?e.style.fontSize:null;return t?parseInt(t,10):null},set:function(e){if(!this.selection.savedValue)throw new Error("There is no selection");document.execCommand("fontSize",!1,"1");var t=this.selection.savedValue.container.getElementsByTagName("font");Array.from(t).forEach((function(t){"1"===t.getAttribute("size")&&(t.removeAttribute("size"),t.style.fontSize=e+"px")}))},enumerable:!0,configurable:!0}),n.ɵfac=function(e){return new(e||n)(t["ɵɵinject"]($))},n.ɵprov=t["ɵɵdefineInjectable"]({token:n,factory:n.ɵfac}),n}(O),V=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),r.prototype.toggle=function(){this.execCommand(e.ExecCommand.Italic)},Object.defineProperty(r.prototype,"value",{get:function(){return!!this.isSelectionExist&&document.queryCommandState(e.ExecCommand.Italic)},enumerable:!0,configurable:!0}),r.ɵfac=function(e){return R(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),R=t["ɵɵgetInheritedFactory"](V),M=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),r.prototype.justify=function(){this.execCommand(e.ExecCommand.JustifyCenter)},Object.defineProperty(r.prototype,"value",{get:function(){return!!this.isSelectionExist&&document.queryCommandState(e.ExecCommand.JustifyCenter)},enumerable:!0,configurable:!0}),r.ɵfac=function(e){return _(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),_=t["ɵɵgetInheritedFactory"](M),D=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),r.prototype.justify=function(){this.execCommand(e.ExecCommand.JustifyFull)},Object.defineProperty(r.prototype,"value",{get:function(){return!!this.isSelectionExist&&document.queryCommandState(e.ExecCommand.JustifyFull)},enumerable:!0,configurable:!0}),r.ɵfac=function(e){return z(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),z=t["ɵɵgetInheritedFactory"](D),J=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),r.prototype.justify=function(){this.execCommand(e.ExecCommand.JustifyLeft)},Object.defineProperty(r.prototype,"value",{get:function(){return!!this.isSelectionExist&&document.queryCommandState(e.ExecCommand.JustifyLeft)},enumerable:!0,configurable:!0}),r.ɵfac=function(e){return q(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),q=t["ɵɵgetInheritedFactory"](J),H=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),r.prototype.justify=function(){this.execCommand(e.ExecCommand.JustifyRight)},Object.defineProperty(r.prototype,"value",{get:function(){return!!this.isSelectionExist&&document.queryCommandState(e.ExecCommand.JustifyRight)},enumerable:!0,configurable:!0}),r.ɵfac=function(e){return B(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),B=t["ɵɵgetInheritedFactory"](H),Q=function(n){function r(e){var t=n.call(this)||this;return t.selection=e,t}return u(r,n),Object.defineProperty(r.prototype,"value",{get:function(){if(!this.selection.savedValue)return null;for(var e=this.selection.savedValue.parentElement;e&&"A"!==e.tagName;)e=e.parentElement;return e&&e.dataset?e.dataset.id:null},set:function(e){e?this.link(e):this.unlink()},enumerable:!0,configurable:!0}),r.prototype.link=function(t){var n=this.selection.findParentTag("A");n&&this.selection.expandToTag(n),this.execCommand(e.ExecCommand.CreateLink,"#"),this.selection.saveSelection(this.selection.getSelection(this.selection.savedValue.container)),this.selection.savedValue.parentElement.dataset.id=t,this.execCommand(e.ExecCommand.CreateLink)},r.prototype.unlink=function(){this.execCommand(e.ExecCommand.Unlink)},r.ɵfac=function(e){return new(e||r)(t["ɵɵinject"]($))},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),X=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),r.prototype.apply=function(t){if(this.value)return this.removeTransformList(t);this.execCommand(e.ExecCommand.InsertOrderedList)},Object.defineProperty(r.prototype,"value",{get:function(){return document.queryCommandState(e.ExecCommand.InsertOrderedList)},enumerable:!0,configurable:!0}),r.prototype.removeTransformList=function(e){if(!e)return e;var t=e.indexOf("<ol>"),n=e.indexOf("</ol>"),r=e.slice(t+4,n).replace(/<li>/g,"").replace(/<\/li>/g,T?"":"<br>"),i=e.split("<ol>"),o=e.split("</ol>");return i[0].concat(r).concat(o[1])},r.ɵfac=function(e){return K(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),K=t["ɵɵgetInheritedFactory"](X),W=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),r.prototype.toggle=function(){this.execCommand(e.ExecCommand.Underline)},Object.defineProperty(r.prototype,"value",{get:function(){return!!this.isSelectionExist&&document.queryCommandState(e.ExecCommand.Underline)},enumerable:!0,configurable:!0}),r.ɵfac=function(e){return G(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),G=t["ɵɵgetInheritedFactory"](W),Y=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return u(r,n),r.prototype.apply=function(t){if(this.value)return this.removeTransformList(t);this.execCommand(e.ExecCommand.InsertUnorderedList)},Object.defineProperty(r.prototype,"value",{get:function(){return document.queryCommandState(e.ExecCommand.InsertUnorderedList)},enumerable:!0,configurable:!0}),r.prototype.removeTransformList=function(e){if(!e)return e;var t=e.indexOf("<ul>"),n=e.indexOf("</ul>"),r=e.slice(t+4,n).replace(/<li>/g,"").replace(/<\/li>/g,T?"":"<br>"),i=e.split("<ul>"),o=e.split("</ul>");return i[0].concat(r).concat(o[1])},r.ɵfac=function(e){return Z(e||r)},r.ɵprov=t["ɵɵdefineInjectable"]({token:r,factory:r.ɵfac}),r}(O),Z=t["ɵɵgetInheritedFactory"](Y),ee=function(){function e(e,i,o,a,u,c,s,l,f,d,p,m,h,g,y){var v=this;this.selection=e,this.boldTransform=i,this.colorTransform=o,this.fontFamilyTransform=a,this.fontSizeTransform=u,this.italicTransform=c,this.linkTransform=s,this.externalLinkTransform=l,this.underlineTransform=f,this.justifyLeftTransform=d,this.justifyRightTransform=p,this.justifyCenterTransform=m,this.justifyFullTransform=h,this.unorderedTransform=g,this.orderedTransform=y,this.stateSubject$=new n.BehaviorSubject(null),this.removeListAlignSubject$=new n.Subject,this.transformationCompletedSubject$=new t.EventEmitter,this.transformationCompleted$=this.transformationCompletedSubject$.asObservable(),this.changed$=n.merge(this.transformationCompletedSubject$,this.selection.savedValue$).pipe(r.share()),this.bold$=this.changed$.pipe(r.map((function(){return v.bold})),r.distinctUntilChanged()),this.color$=this.changed$.pipe(r.map((function(){return v.color})),r.distinctUntilChanged()),this.fontSize$=this.changed$.pipe(r.map((function(){return v.fontSize})),r.distinctUntilChanged()),this.fontFamily$=this.changed$.pipe(r.map((function(){return v.fontFamily})),r.distinctUntilChanged()),this.italic$=this.changed$.pipe(r.map((function(){return v.italic})),r.distinctUntilChanged()),this.link$=this.changed$.pipe(r.map((function(){return v.link})),r.distinctUntilChanged()),this.externalLink$=this.changed$.pipe(r.map((function(){return v.externalLink})),r.distinctUntilChanged()),this.justifyCenter$=this.changed$.pipe(r.map((function(){return v.justifyCenter})),r.distinctUntilChanged()),this.justifyLeft$=this.changed$.pipe(r.map((function(){return v.justifyLeft})),r.distinctUntilChanged()),this.justifyRight$=this.changed$.pipe(r.map((function(){return v.justifyRight})),r.distinctUntilChanged()),this.justifyFull$=this.changed$.pipe(r.map((function(){return v.justifyFull})),r.distinctUntilChanged()),this.orderedList$=this.changed$.pipe(r.map((function(){return v.orderedList})),r.distinctUntilChanged()),this.underline$=this.changed$.pipe(r.map((function(){return v.underline})),r.distinctUntilChanged()),this.unorderedList$=this.changed$.pipe(r.map((function(){return v.unorderedList})),r.distinctUntilChanged()),this.value$=this.stateSubject$.asObservable().pipe(r.distinctUntilChanged())}return Object.defineProperty(e.prototype,"value",{get:function(){return this.stateSubject$.getValue()},set:function(e){this.stateSubject$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"link",{get:function(){return this.linkTransform.value},set:function(e){this.selection.restore(),this.externalLink&&(this.externalLinkTransform.value=null),this.linkTransform.value=e,this.transformationCompletedSubject$.next()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"externalLink",{get:function(){return this.externalLinkTransform.value},set:function(e){this.selection.restore(),this.link&&(this.linkTransform.value=null),this.externalLinkTransform.value=e,this.transformationCompletedSubject$.next()},enumerable:!0,configurable:!0}),e.prototype.toggleBold=function(){this.selection.restore(),this.boldTransform.toggle(),this.transformationCompletedSubject$.next()},Object.defineProperty(e.prototype,"bold",{get:function(){return this.boldTransform.value},enumerable:!0,configurable:!0}),e.prototype.toggleItalic=function(){this.selection.restore(),this.italicTransform.toggle(),this.transformationCompletedSubject$.next()},Object.defineProperty(e.prototype,"italic",{get:function(){return this.italicTransform.value},enumerable:!0,configurable:!0}),e.prototype.toggleUnderline=function(){this.selection.restore(),this.underlineTransform.toggle(),this.transformationCompletedSubject$.next()},Object.defineProperty(e.prototype,"underline",{get:function(){return this.underlineTransform.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){var e=this.fontSizeTransform.value;return"number"==typeof e?e:null},set:function(e){this.selection.restore(),this.fontSizeTransform.value=e,this.transformationCompletedSubject$.next()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.colorTransform.value},set:function(e){this.selection.restore(),this.colorTransform.value=e,this.transformationCompletedSubject$.next()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.fontFamilyTransform.value},set:function(e){this.selection.restore(),this.fontFamilyTransform.value=e,this.transformationCompletedSubject$.next()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"justifyLeft",{get:function(){return this.justifyLeftTransform.value},enumerable:!0,configurable:!0}),e.prototype.toggleJustifyLeft=function(){this.justifyLeftTransform.justify(),this.transformationCompletedSubject$.next()},Object.defineProperty(e.prototype,"justifyRight",{get:function(){return this.justifyRightTransform.value},enumerable:!0,configurable:!0}),e.prototype.toggleJustifyRight=function(){this.justifyRightTransform.justify(),this.transformationCompletedSubject$.next()},Object.defineProperty(e.prototype,"justifyCenter",{get:function(){return this.justifyCenterTransform.value},enumerable:!0,configurable:!0}),e.prototype.toggleJustifyCenter=function(){this.justifyCenterTransform.justify(),this.transformationCompletedSubject$.next()},Object.defineProperty(e.prototype,"justifyFull",{get:function(){return this.justifyFullTransform.value},enumerable:!0,configurable:!0}),e.prototype.toggleJustifyFull=function(){this.justifyFullTransform.justify(),this.transformationCompletedSubject$.next()},Object.defineProperty(e.prototype,"unorderedList",{get:function(){return this.unorderedTransform.value},enumerable:!0,configurable:!0}),e.prototype.toggleUnorderedList=function(){var e=this.unorderedTransform.apply(this.value);e?(this.value=e,this.removeListAlignSubject$.next(e)):this.removeListAlignSubject$.next(null),this.transformationCompletedSubject$.next()},Object.defineProperty(e.prototype,"orderedList",{get:function(){return this.orderedTransform.value},enumerable:!0,configurable:!0}),e.prototype.toggleOrderedList=function(){var e=this.orderedTransform.apply(this.value);e?(this.value=e,this.removeListAlignSubject$.next(e)):this.removeListAlignSubject$.next(null),this.transformationCompletedSubject$.next()},e.prototype.saveSelection=function(e){this.selection.saveSelection(e)},e.prototype.findParentTag=function(e){return this.selection.findParentTag(e)},e.ɵfac=function(n){return new(n||e)(t["ɵɵinject"]($),t["ɵɵinject"](k),t["ɵɵinject"](P),t["ɵɵinject"](A),t["ɵɵinject"](U),t["ɵɵinject"](V),t["ɵɵinject"](Q),t["ɵɵinject"](N),t["ɵɵinject"](W),t["ɵɵinject"](J),t["ɵɵinject"](H),t["ɵɵinject"](M),t["ɵɵinject"](D),t["ɵɵinject"](Y),t["ɵɵinject"](X))},e.ɵprov=t["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac}),e}(),te=function(){function e(e,t,n){this.blockManager=e,this.selection=t,this.injector=n}return e.prototype.init=function(){},e.ɵfac=function(n){return new(n||e)(t["ɵɵinject"](ee),t["ɵɵinject"]($),t["ɵɵinject"](t.Injector))},e.ɵprov=t["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac}),e}(),ne=function(){function e(e){this.sanitized=e}return e.prototype.transform=function(e){return this.sanitized.bypassSecurityTrustHtml(e)},e.ɵfac=function(n){return new(n||e)(t["ɵɵdirectiveInject"](i.DomSanitizer))},e.ɵpipe=t["ɵɵdefinePipe"]({name:"safeHtml",type:e,pure:!0}),e}(),re=["textArea"],ie=function(){function i(e,r,i){this.injector=e,this.changeDetectorRef=r,this.selectionHelper=i,this.initialValue$=new n.BehaviorSubject(""),this.changes$=new n.Subject,this.destroy$=new n.Subject,this.editing=!1,this.changed=new t.EventEmitter,this.textEditor=this.injector.get(te),this.state=this.injector.get(ee)}return Object.defineProperty(i.prototype,"value",{set:function(e){e&&this.initialValue$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textAreaElement",{get:function(){return this.textArea.nativeElement},enumerable:!0,configurable:!0}),i.prototype.ngAfterViewInit=function(){this.bindEvents()},i.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.complete()},i.prototype.onInput=function(){this.changes$.next(this.textArea.nativeElement.innerHTML),this.state.value=this.textArea.nativeElement.innerHTML},i.prototype.onBlur=function(){this.state.value=this.textArea.nativeElement.innerHTML},i.prototype.onPaste=function(t){t.preventDefault();var n=t.clipboardData.getData("text");document.execCommand(e.ExecCommand.InsertText,!1,n)},i.prototype.bindEvents=function(){var e=this;this.changes$.pipe(r.tap((function(t){return e.changed.emit(t)})),r.takeUntil(this.destroy$)).subscribe(),n.merge(n.fromEvent(this.textArea.nativeElement,"keyup"),n.fromEvent(this.textArea.nativeElement,"click"),n.fromEvent(this.textArea.nativeElement,"mousemove"),this.state.transformationCompleted$).pipe(r.filter((function(){return e.editing})),r.map((function(){return e.selectionHelper.get(e.textArea.nativeElement)})),r.filter((function(e){return!!e})),r.distinctUntilChanged((function(e,t){return JSON.stringify(e)===JSON.stringify(t)})),r.tap((function(t){return e.state.saveSelection(t)})),r.takeUntil(this.destroy$)).subscribe()},i.ɵfac=function(e){return new(e||i)(t["ɵɵdirectiveInject"](t.Injector),t["ɵɵdirectiveInject"](t.ChangeDetectorRef),t["ɵɵdirectiveInject"](w))},i.ɵcmp=t["ɵɵdefineComponent"]({type:i,selectors:[["peb-text-editor-new"]],viewQuery:function(e,n){var r;(1&e&&t["ɵɵstaticViewQuery"](re,!0),2&e)&&(t["ɵɵqueryRefresh"](r=t["ɵɵloadQuery"]())&&(n.textArea=r.first))},inputs:{value:"value",editing:"editing"},outputs:{changed:"changed"},decls:4,vars:6,consts:[["id","text-editor","data-placeholder","Text",3,"innerHtml","contentEditable","input","blur","paste"],["textArea",""]],template:function(e,n){1&e&&(t["ɵɵelementStart"](0,"div",0,1),t["ɵɵlistener"]("input",(function(){return n.onInput()}))("blur",(function(){return n.onBlur()}))("paste",(function(e){return n.onPaste(e)})),t["ɵɵpipe"](2,"safeHtml"),t["ɵɵpipe"](3,"async"),t["ɵɵelementEnd"]()),2&e&&t["ɵɵproperty"]("innerHtml",t["ɵɵpipeBind1"](2,2,t["ɵɵpipeBind1"](3,4,n.initialValue$)),t["ɵɵsanitizeHtml"])("contentEditable",n.editing)},pipes:[ne,o.AsyncPipe],styles:["#text-editor[_ngcontent-%COMP%]{position:relative;margin:2px;z-index:999;outline:0;word-break:break-word;color:#000;cursor:text;line-height:normal}#text-editor[contenteditable][_ngcontent-%COMP%]{font-weight:350}#text-editor[contenteditable=true][_ngcontent-%COMP%]{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;cursor:text}#text-editor[contenteditable=false][_ngcontent-%COMP%]{cursor:default}#text-editor[_ngcontent-%COMP%]:empty:before{content:attr(data-placeholder);color:gray}.pe-te-p[_ngcontent-%COMP%]{margin-bottom:1em;margin-top:1em}"]}),i}(),oe=function(){function e(){}return e.ɵfac=function(t){return new(t||e)},e.ɵdir=t["ɵɵdefineDirective"]({type:e,selectors:[["","peTextEditorElementDef",""]]}),e}(),ae=[te,ee,$,k,P,A,U,V,Q,N,W,M,J,H,D,Y,X,w,ie],ue=function(){function e(){}return e.ɵmod=t["ɵɵdefineNgModule"]({type:e}),e.ɵinj=t["ɵɵdefineInjector"]({factory:function(t){return new(t||e)},providers:ae,imports:[[o.CommonModule]]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&t["ɵɵsetNgModuleScope"](ue,{declarations:[ie,oe,ne],imports:[o.CommonModule],exports:[ie]}),e.PebLinkDatasetRouteKey="id",e.PebLinkDatasetURLKey="url",e.PebTextEditorModule=ue,e.StateService=ee,e.TextEditorComponent=ie,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pe-builder-text-editor.umd.min.js.map